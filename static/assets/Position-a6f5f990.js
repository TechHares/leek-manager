import{g as e,a as l,c as a}from"./position-ad296b53.js";import{a5 as t,a6 as i,c as s,o,d,f as r,w as u,t as n,z as c,e as f,i as m,x as _,A as p,q as b,p as y}from"./index-996b1aff.js";import{P as g}from"./index-e7ada867.js";import{a as h}from"./format-76ff4d5a.js";import{b as w,c as v,s as x,e as V}from"./enum-9649b8be.js";import{_ as D}from"./_plugin-vue_export-helper-1b428a4d.js";const k={class:"position-page"},N={class:"header-bar"},Q={class:"table-actions"},C={class:"left-actions"},z={key:0,class:"text-center py-4"},$={key:1},T={class:"text-end"};const L=D({name:"Position",components:{View:t,Close:i,Pagination:g},data:()=>({list:null,total:0,listLoading:!0,listQuery:{page:1,size:20,strategy_id:void 0,symbol:void 0,is_closed:void 0,ins_type:void 0,asset_type:void 0,is_fake:!1},detailDialogVisible:!1,detail:{}}),created(){this.getList()},methods:{insTypeDesc:w,assetTypeDesc:v,sideZh:x,getPositionSideTag:V,async getList(){this.listLoading=!0;try{const{data:l}=await e(this.listQuery);this.list=l.items,this.total=l.total}catch(l){this.$message.error("获取仓位列表失败")}this.listLoading=!1},handleFilter(){this.getList()},async handleDetail(e){try{const{data:a}=await l(e.id);this.detail=a,this.detailDialogVisible=!0}catch(a){this.$message.error("获取仓位详情失败")}},async handleClose(e){try{await this.$confirm("确认平仓该仓位(平仓不会立即修改仓位状态，需要等待策略执行器处理，请勿重复平仓)?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await a(e.id),this.$message.success("平仓成功"),this.getList(),this.detailDialogVisible&&(this.detailDialogVisible=!1)}catch(l){"cancel"!==l&&this.$message.error("平仓失败")}},formatDate(e){if(!e)return"";const l=new Date(e),a=e=>e.toString().padStart(2,"0");return`${l.getFullYear()}-${a(l.getMonth()+1)}-${a(l.getDate())} ${a(l.getHours())}:${a(l.getMinutes())}:${a(l.getSeconds())}`},formatNumber:h,tableRowClassName:({row:e})=>e.is_fake?"fake-row":""}},[["render",function(e,l,a,t,i,g){const h=s("el-input"),w=s("el-option"),v=s("el-select"),x=s("el-button"),V=s("el-skeleton"),D=s("el-table-column"),L=s("el-tag"),U=s("View"),P=s("el-icon"),S=s("el-tooltip"),j=s("Close"),I=s("el-table"),q=s("el-card"),F=s("pagination"),Z=s("el-descriptions-item"),B=s("el-descriptions"),M=s("el-dialog");return o(),d("div",k,[r(q,{shadow:"hover"},{header:u((()=>[f("div",N,[f("div",Q,[f("div",C,[r(h,{modelValue:i.listQuery.strategy_id,"onUpdate:modelValue":l[0]||(l[0]=e=>i.listQuery.strategy_id=e),placeholder:"策略ID",style:{width:"200px"},class:"filter-item"},null,8,["modelValue"]),r(h,{modelValue:i.listQuery.symbol,"onUpdate:modelValue":l[1]||(l[1]=e=>i.listQuery.symbol=e),placeholder:"交易标的",style:{width:"200px"},class:"filter-item"},null,8,["modelValue"]),r(v,{modelValue:i.listQuery.is_closed,"onUpdate:modelValue":l[2]||(l[2]=e=>i.listQuery.is_closed=e),placeholder:"仓位状态",clearable:"",style:{width:"120px"},class:"filter-item"},{default:u((()=>[r(w,{label:"持仓中",value:!1}),r(w,{label:"已平仓",value:!0})])),_:1},8,["modelValue"]),r(v,{modelValue:i.listQuery.ins_type,"onUpdate:modelValue":l[3]||(l[3]=e=>i.listQuery.ins_type=e),placeholder:"产品类型",clearable:"",style:{width:"120px"},class:"filter-item"},{default:u((()=>[r(w,{label:"现货",value:1}),r(w,{label:"杠杆",value:2}),r(w,{label:"合约",value:3}),r(w,{label:"期货",value:4}),r(w,{label:"期权",value:5})])),_:1},8,["modelValue"]),r(v,{modelValue:i.listQuery.asset_type,"onUpdate:modelValue":l[4]||(l[4]=e=>i.listQuery.asset_type=e),placeholder:"资产类型",clearable:"",style:{width:"120px"},class:"filter-item"},{default:u((()=>[r(w,{label:"股票",value:"stock"}),r(w,{label:"期货",value:"futures"}),r(w,{label:"加密货币",value:"crypto"}),r(w,{label:"外汇",value:"forex"}),r(w,{label:"指数",value:"index"}),r(w,{label:"债券",value:"bond"}),r(w,{label:"商品",value:"commodity"}),r(w,{label:"期权",value:"option"})])),_:1},8,["modelValue"]),r(v,{modelValue:i.listQuery.is_fake,"onUpdate:modelValue":l[5]||(l[5]=e=>i.listQuery.is_fake=e),placeholder:"仓位",clearable:"",style:{width:"120px"},class:"filter-item"},{default:u((()=>[r(w,{label:"真仓位",value:!1}),r(w,{label:"虚拟仓位",value:!0})])),_:1},8,["modelValue"]),r(x,{type:"primary",onClick:g.handleFilter,class:"filter-item"},{default:u((()=>l[11]||(l[11]=[m("查询")]))),_:1},8,["onClick"])])])])])),default:u((()=>[i.listLoading?(o(),d("div",z,[r(V,{rows:4,animated:""})])):(o(),d("div",$,[r(I,{data:i.list||[],style:{width:"100%"},size:"small",align:"center",border:"",fit:"","highlight-current-row":"","row-class-name":g.tableRowClassName},{default:u((()=>[r(D,{label:"ID",align:"center"},{default:u((e=>[m(_(e.row.id),1)])),_:1}),r(D,{label:"交易标的"},{default:u((e=>[r(L,{type:"info"},{default:u((()=>[m(_(g.insTypeDesc(e.row.ins_type)),1)])),_:2},1024),m(" "+_(e.row.symbol)+" - "+_(e.row.quote_currency),1)])),_:1}),r(D,{label:"方向/杠杆",align:"center"},{default:u((e=>[r(L,{type:g.getPositionSideTag(e.row.side)},{default:u((()=>[m(_(g.sideZh(e.row.side)),1)])),_:2},1032,["type"]),r(L,{type:e.row.leverage>=1?"info":"danger"},{default:u((()=>[m(_(g.formatNumber(e.row.leverage,2))+"x ",1)])),_:2},1032,["type"])])),_:1}),r(D,{label:"累计交易金额",align:"right"},{default:u((e=>[m(_(g.formatNumber(e.row.total_amount,4)),1)])),_:1}),r(D,{label:"累计仓位数量",align:"right"},{default:u((e=>[m(_(g.formatNumber(e.row.total_sz,12)),1)])),_:1}),r(D,{label:"平均开仓价",align:"right"},{default:u((e=>[m(_(g.formatNumber(e.row.cost_price,12)),1)])),_:1}),r(D,{label:"已实现盈亏",align:"right"},{default:u((e=>[f("span",{class:p(e.row.pnl>=0?"text-success":"text-danger")},_(g.formatNumber(e.row.pnl,8)),3)])),_:1}),r(D,{label:"状态",align:"center"},{default:u((e=>[e.row.is_fake?(o(),b(L,{key:0,type:"warning"},{default:u((()=>l[12]||(l[12]=[m(" 虚拟 ")]))),_:1})):y("",!0),r(L,{type:e.row.is_closed?"info":"success"},{default:u((()=>[m(_(e.row.is_closed?"已平仓":"持仓中"),1)])),_:2},1032,["type"])])),_:1}),r(D,{label:"开仓时间",align:"center"},{default:u((e=>[m(_(g.formatDate(e.row.open_time)),1)])),_:1}),r(D,{label:"操作",align:"center"},{default:u((e=>[r(S,{content:"查看详情",placement:"top"},{default:u((()=>[r(x,{size:"small",onClick:l=>g.handleDetail(e.row),circle:""},{default:u((()=>[r(P,null,{default:u((()=>[r(U)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024),e.row.is_closed?y("",!0):(o(),b(S,{key:0,content:"平仓",placement:"top"},{default:u((()=>[r(x,{size:"small",type:"danger",onClick:l=>g.handleClose(e.row),circle:""},{default:u((()=>[r(P,null,{default:u((()=>[r(j)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024))])),_:1})])),_:1},8,["data","row-class-name"])]))])),_:1}),n(r(F,{total:i.total,page:i.listQuery.page,"onUpdate:page":l[6]||(l[6]=e=>i.listQuery.page=e),limit:i.listQuery.size,"onUpdate:limit":l[7]||(l[7]=e=>i.listQuery.size=e),onPagination:g.getList},null,8,["total","page","limit","onPagination"]),[[c,i.total>0]]),r(M,{title:"仓位详情",modelValue:i.detailDialogVisible,"onUpdate:modelValue":l[10]||(l[10]=e=>i.detailDialogVisible=e),width:"900px"},{footer:u((()=>[f("div",T,[r(x,{onClick:l[8]||(l[8]=e=>i.detailDialogVisible=!1)},{default:u((()=>l[13]||(l[13]=[m("关闭")]))),_:1}),i.detail.is_closed?y("",!0):(o(),b(x,{key:0,type:"danger",onClick:l[9]||(l[9]=e=>g.handleClose(i.detail))},{default:u((()=>l[14]||(l[14]=[m(" 平仓 ")]))),_:1}))])])),default:u((()=>[r(B,{column:2,border:""},{default:u((()=>[r(Z,{label:"ID"},{default:u((()=>[m(_(i.detail.id),1)])),_:1}),r(Z,{label:"策略ID"},{default:u((()=>[m(_(i.detail.strategy_id),1)])),_:1}),r(Z,{label:"策略实例"},{default:u((()=>[m(_(i.detail.strategy_instance_id),1)])),_:1}),r(Z,{label:"交易标的"},{default:u((()=>[m(_(i.detail.symbol)+" - "+_(i.detail.quote_currency),1)])),_:1}),r(Z,{label:"产品类型"},{default:u((()=>[r(L,{type:"success"},{default:u((()=>[m(_(g.assetTypeDesc(i.detail.asset_type)),1)])),_:1}),r(L,{type:"info"},{default:u((()=>[m(_(g.insTypeDesc(i.detail.ins_type)),1)])),_:1})])),_:1}),r(Z,{label:"方向"},{default:u((()=>[r(L,{type:g.getPositionSideTag(i.detail.side)},{default:u((()=>[m(_(g.sideZh(i.detail.side)),1)])),_:1},8,["type"])])),_:1}),r(Z,{label:"金额"},{default:u((()=>[m(_(g.formatNumber(i.detail.amount,4)),1)])),_:1}),r(Z,{label:"数量"},{default:u((()=>[m(_(g.formatNumber(i.detail.sz,4)),1)])),_:1}),r(Z,{label:"累计交易金额"},{default:u((()=>[m(_(g.formatNumber(i.detail.total_amount,4)),1)])),_:1}),r(Z,{label:"累计成交数量"},{default:u((()=>[m(_(g.formatNumber(i.detail.total_sz,4)),1)])),_:1}),r(Z,{label:"最大仓位价值"},{default:u((()=>[m(_(g.formatNumber(i.detail.max_amount,4)),1)])),_:1}),r(Z,{label:"最大持仓数量"},{default:u((()=>[m(_(g.formatNumber(i.detail.max_sz,4)),1)])),_:1}),r(Z,{label:"平均开仓价"},{default:u((()=>[m(_(g.formatNumber(i.detail.cost_price,12)),1)])),_:1}),r(Z,{label:"平均平仓价"},{default:u((()=>[m(_(i.detail.close_price?g.formatNumber(i.detail.close_price,12):"-"),1)])),_:1}),r(Z,{label:"占资金比例"},{default:u((()=>[m(_(g.formatNumber(100*i.detail.ratio,1))+"%",1)])),_:1}),r(Z,{label:"最大仓位"},{default:u((()=>[m(_(g.formatNumber(i.detail.max_sz,4)),1)])),_:1}),r(Z,{label:"执行器ID"},{default:u((()=>[m(_(i.detail.executor_id),1)])),_:1}),r(Z,{label:"假仓位"},{default:u((()=>[r(L,{type:i.detail.is_fake?"warning":"info"},{default:u((()=>[m(_(i.detail.is_fake?"是":"否"),1)])),_:1},8,["type"])])),_:1}),r(Z,{label:"盈亏"},{default:u((()=>[f("span",{class:p(i.detail.pnl>=0?"text-success":"text-danger")},_(g.formatNumber(i.detail.pnl,8)),3)])),_:1}),r(Z,{label:"手续费"},{default:u((()=>[m(_(g.formatNumber(i.detail.fee,12)),1)])),_:1}),r(Z,{label:"摩擦成本"},{default:u((()=>[m(_(g.formatNumber(i.detail.friction,12)),1)])),_:1}),r(Z,{label:"杠杆"},{default:u((()=>[m(_(g.formatNumber(i.detail.leverage,2))+"x",1)])),_:1}),r(Z,{label:"平仓时间"},{default:u((()=>[m(_(i.detail.close_time?g.formatDate(i.detail.close_time):"-"),1)])),_:1}),r(Z,{label:"状态"},{default:u((()=>[r(L,{type:i.detail.is_closed?"info":"success"},{default:u((()=>[m(_(i.detail.is_closed?"已平仓":"持仓中"),1)])),_:1},8,["type"])])),_:1}),r(Z,{label:"下单时间"},{default:u((()=>[m(_(g.formatDate(i.detail.open_time)),1)])),_:1}),r(Z,{label:"更新时间"},{default:u((()=>[m(_(g.formatDate(i.detail.updated_at)),1)])),_:1}),i.detail.is_closed?y("",!0):(o(),b(Z,{key:0,label:"仓位分布"},{default:u((()=>[m(_(i.detail.executor_sz?JSON.stringify(i.detail.executor_sz,null,2):"-"),1)])),_:1}))])),_:1})])),_:1},8,["modelValue"])])}],["__scopeId","data-v-b46f975b"]]);export{L as default};
