import{r as e,y as a,m as l,c as t,o as u,d as o,f as r,w as d,E as n,e as m,i as s,h as i,F as p,O as _,p as v,A as c,q as f,a4 as b,x as y,n as x}from"./index-996b1aff.js";import{b as g,d as V,u as h}from"./position-ad296b53.js";import{D as k}from"./DynamicForm-adccf113.js";import{b as U}from"./format-76ff4d5a.js";import{_ as q}from"./_plugin-vue_export-helper-1b428a4d.js";const w={class:"position-setting-page"},j={class:"header-bar"},C={class:"policy-list",style:{"min-height":"220px"}},O=["onClick"],S={key:0,style:{color:"#b0b3b8","text-align":"center","margin-top":"40px"}},z={key:1,style:{color:"#b0b3b8",padding:"24px"}},D=q({__name:"PositionSetting",setup(q){const D=e({init_amount:"",max_strategy_amount:"",max_strategy_ratio:"",max_symbol_amount:"",max_symbol_ratio:"",max_amount:"",max_ratio:"",risk_policies:[],trade_mode:"isolated",default_leverage:"3",order_type:2,trade_type:4}),E=e(!1),F=e(null),J=e([]),N=e([]),A=e(0),I=e=>N.value.find((a=>a.name===e))||{},P=a((()=>J.value[A.value]||null));a((()=>{var e;return I(null==(e=P.value)?void 0:e.name)}));const R=a({get(){if(!P.value)return{};const e=I(P.value.name),a={};for(const l of P.value.parameters||[])a[l.name]=e.params&&void 0!==e.params[l.name]?e.params[l.name]:l.default;return a},set(e){var a;const l=null==(a=P.value)?void 0:a.name;if(!l)return;let t=N.value.find((e=>e.name===l));t||(t={name:l,enabled:!1,params:{},class_name:P.value.cls},N.value.push(t)),t.params={...e}}}),B=e=>{var a;return(null==(a=I(e))?void 0:a.enabled)||!1},G=async()=>{E.value=!0;try{const e=N.value.map((e=>{if(!e.class_name){const a=J.value.find((a=>a.name===e.name));a&&(e.class_name=a.cls)}return e}));await h({...D.value,risk_policies:JSON.parse(JSON.stringify(e))}),n.success("保存成功")}catch(e){n.error("保存失败")}E.value=!1};return l((async()=>{const{data:e}=await g();J.value=e,await(async()=>{try{const{data:e}=await V();Object.keys(D.value).forEach((a=>{void 0!==e[a]&&(D.value[a]=e[a])})),N.value=(e.risk_policies||[]).map((e=>{if(!e.class_name){const a=J.value.find((a=>a.name===e.name));a&&(e.class_name=a.cls)}return e}))}catch(e){n.error("加载仓位设置失败")}})()})),(e,a)=>{const l=t("el-button"),n=t("el-input"),g=t("el-form-item"),V=t("el-col"),h=t("el-icon"),q=t("el-tooltip"),I=t("el-radio"),H=t("el-radio-group"),K=t("el-row"),L=t("el-tag"),M=t("el-switch"),Q=t("el-form"),T=t("el-card");return u(),o("div",w,[r(T,null,{header:d((()=>[m("div",j,[a[14]||(a[14]=m("span",null,"仓位设置",-1)),r(l,{type:"primary",onClick:G,loading:E.value,style:{float:"right"}},{default:d((()=>a[13]||(a[13]=[s("保存")]))),_:1},8,["loading"])])])),default:d((()=>[r(Q,{model:D.value,"label-width":"200px",ref_key:"formRef",ref:F},{default:d((()=>[r(K,{gutter:40},{default:d((()=>[r(V,{span:12},{default:d((()=>[r(g,{label:"初始余额",prop:"init_amount",required:""},{default:d((()=>[r(n,{modelValue:D.value.init_amount,"onUpdate:modelValue":a[0]||(a[0]=e=>D.value.init_amount=e),type:"text"},null,8,["modelValue"])])),_:1}),r(g,{label:"单个策略最大仓位",prop:"max_strategy_amount",required:""},{default:d((()=>[r(n,{modelValue:D.value.max_strategy_amount,"onUpdate:modelValue":a[1]||(a[1]=e=>D.value.max_strategy_amount=e),type:"number",placeholder:"请输入单个策略最大仓位"},null,8,["modelValue"])])),_:1}),r(g,{label:"单个策略最大仓位比例(%)",prop:"max_strategy_ratio",required:""},{default:d((()=>[r(n,{modelValue:D.value.max_strategy_ratio,"onUpdate:modelValue":a[2]||(a[2]=e=>D.value.max_strategy_ratio=e),type:"number",placeholder:"请输入单个策略最大仓位比例"},null,8,["modelValue"])])),_:1}),r(g,{label:"单个标的最大仓位",prop:"max_symbol_amount",required:""},{default:d((()=>[r(n,{modelValue:D.value.max_symbol_amount,"onUpdate:modelValue":a[3]||(a[3]=e=>D.value.max_symbol_amount=e),type:"number",placeholder:"请输入单个标的最大仓位"},null,8,["modelValue"])])),_:1}),r(g,{label:"单个标的最大仓位比例(%)",prop:"max_symbol_ratio",required:""},{default:d((()=>[r(n,{modelValue:D.value.max_symbol_ratio,"onUpdate:modelValue":a[4]||(a[4]=e=>D.value.max_symbol_ratio=e),type:"number",placeholder:"请输入单个标的最大仓位比例"},null,8,["modelValue"])])),_:1}),r(g,{label:"单次开仓最大仓位",prop:"max_amount",required:""},{default:d((()=>[r(n,{modelValue:D.value.max_amount,"onUpdate:modelValue":a[5]||(a[5]=e=>D.value.max_amount=e),type:"number",placeholder:"请输入单次开仓最大仓位"},null,8,["modelValue"])])),_:1}),r(g,{label:"单次开仓最大仓位比例(%)",prop:"max_ratio",required:""},{default:d((()=>[r(n,{modelValue:D.value.max_ratio,"onUpdate:modelValue":a[6]||(a[6]=e=>D.value.max_ratio=e),type:"number",placeholder:"请输入单次开仓最大仓位比例"},null,8,["modelValue"])])),_:1})])),_:1}),r(V,{span:12},{default:d((()=>[r(g,{label:"默认交易模式",prop:"trade_mode",required:""},{label:d((()=>[a[15]||(a[15]=s(" 默认交易模式 ")),r(q,{content:"策略不指定交易模式时的默认交易模式",placement:"top"},{default:d((()=>[r(h,{style:{"margin-left":"4px",color:"#b0b3b8",cursor:"pointer"}},{default:d((()=>[r(i(b))])),_:1})])),_:1})])),default:d((()=>[r(H,{modelValue:D.value.trade_mode,"onUpdate:modelValue":a[7]||(a[7]=e=>D.value.trade_mode=e)},{default:d((()=>[r(I,{value:"isolated"},{default:d((()=>a[16]||(a[16]=[s("逐仓")]))),_:1}),r(I,{value:"cross"},{default:d((()=>a[17]||(a[17]=[s("全仓")]))),_:1}),r(I,{value:"cash"},{default:d((()=>a[18]||(a[18]=[s("现货")]))),_:1}),r(I,{value:"spot_isolated"},{default:d((()=>a[19]||(a[19]=[s("现货带单")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),r(g,{label:"默认杠杆倍数",prop:"default_leverage",required:""},{label:d((()=>[a[20]||(a[20]=s(" 默认杠杆倍数 ")),r(q,{content:"策略不指定杠杆倍数时的默认杠杆倍数",placement:"top"},{default:d((()=>[r(h,{style:{"margin-left":"4px",color:"#b0b3b8",cursor:"pointer"}},{default:d((()=>[r(i(b))])),_:1})])),_:1})])),default:d((()=>[r(n,{modelValue:D.value.default_leverage,"onUpdate:modelValue":a[8]||(a[8]=e=>D.value.default_leverage=e),type:"number"},null,8,["modelValue"])])),_:1}),r(g,{label:"默认订单类型",prop:"order_type",required:""},{label:d((()=>[a[21]||(a[21]=s(" 默认订单类型 ")),r(q,{content:"策略不指定订单类型时的默认订单类型",placement:"top"},{default:d((()=>[r(h,{style:{"margin-left":"4px",color:"#b0b3b8",cursor:"pointer"}},{default:d((()=>[r(i(b))])),_:1})])),_:1})])),default:d((()=>[r(H,{modelValue:D.value.order_type,"onUpdate:modelValue":a[9]||(a[9]=e=>D.value.order_type=e)},{default:d((()=>[r(I,{value:2},{default:d((()=>a[22]||(a[22]=[s("限价")]))),_:1}),r(I,{value:1},{default:d((()=>a[23]||(a[23]=[s("市价")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),r(g,{label:"默认交易类型",prop:"trade_type",required:""},{label:d((()=>[a[24]||(a[24]=s(" 默认交易类型 ")),r(q,{content:"策略不指定交易类型时的默认交易类型",placement:"top"},{default:d((()=>[r(h,{style:{"margin-left":"4px",color:"#b0b3b8",cursor:"pointer"}},{default:d((()=>[r(i(b))])),_:1})])),_:1})])),default:d((()=>[r(H,{modelValue:D.value.trade_type,"onUpdate:modelValue":a[10]||(a[10]=e=>D.value.trade_type=e)},{default:d((()=>[r(I,{value:1},{default:d((()=>a[25]||(a[25]=[s("现货")]))),_:1}),r(I,{value:2},{default:d((()=>a[26]||(a[26]=[s("杠杆")]))),_:1}),r(I,{value:3},{default:d((()=>a[27]||(a[27]=[s("合约")]))),_:1}),r(I,{value:4},{default:d((()=>a[28]||(a[28]=[s("期货")]))),_:1}),r(I,{value:5},{default:d((()=>a[29]||(a[29]=[s("期权")]))),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),r(g,{label:"风控策略",prop:"risk_policies"},{default:d((()=>[r(K,{gutter:24,style:{width:"100%"}},{default:d((()=>[r(V,{span:7,style:{"min-width":"200px"}},{default:d((()=>[m("div",C,[(u(!0),o(p,null,_(J.value,((e,l)=>(u(),o("div",{key:e.cls,onClick:e=>(e=>{A.value=e})(l),class:c({active:l===A.value}),style:{display:"flex","align-items":"center","justify-content":"space-between",cursor:"pointer","margin-bottom":"8px"}},[m("span",null,[s(y(e.name)+" ",1),e.tag?(u(),f(L,{key:0,size:"small",type:"info",effect:"plain",style:{"margin-left":"6px","font-size":"12px",color:"#b0b3b8","border-color":"#e0e0e0"}},{default:d((()=>[s(y(i(U)(e.tag)),1)])),_:2},1024)):v("",!0)]),r(M,{"model-value":B(e.name),"onUpdate:modelValue":a=>((e,a)=>{let l=N.value.find((a=>a.name===e));if(!l){const t=J.value.find((a=>a.name===e));l={name:e,enabled:a,params:{},class_name:null==t?void 0:t.cls},N.value.push(l)}l.enabled=a})(e.name,a),onClick:a[11]||(a[11]=x((()=>{}),["stop"]))},null,8,["model-value","onUpdate:modelValue"])],10,O)))),128)),J.value.length?v("",!0):(u(),o("div",S,"暂无策略"))])])),_:1}),r(V,{span:1,class:"vertical-divider-col"},{default:d((()=>a[30]||(a[30]=[m("div",{class:"vertical-divider"},null,-1)]))),_:1}),r(V,{span:16},{default:d((()=>[P.value?(u(),o("div",{key:0,class:c({"param-disabled":!B(P.value.name)}),style:{padding:"2px",background:"#fff","min-height":"100px"}},[(u(),f(k,{fields:P.value.parameters||[],modelValue:R.value,"onUpdate:modelValue":a[12]||(a[12]=e=>R.value=e),key:P.value.name,disabled:!B(P.value.name)},null,8,["fields","modelValue","disabled"]))],2)):(u(),o("div",z,"请选择左侧策略"))])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1})])}}},[["__scopeId","data-v-1ceaf85f"]]);export{D as default};
