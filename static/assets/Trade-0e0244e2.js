import{g as e,a,c as t,u as l,d as s}from"./executor-c862610e.js";import{c as i,o as r,d as o,f as n,w as d,e as m,g as c,i as p,x as u,q as h,p as g,t as f,z as y,F as b,O as _}from"./index-996b1aff.js";import{P as x}from"./index-e7ada867.js";import{D as V}from"./DynamicForm-adccf113.js";import{_ as T}from"./_plugin-vue_export-helper-1b428a4d.js";const w={class:"executor-trade-page"},v={class:"header-bar"},F={class:"table-actions"},$={class:"left-actions"},k={class:"right-actions"},C={key:0,class:"text-center py-4"},D={key:1},j={class:"param-scroll-area"},U={key:1,style:{color:"#b0b3b8"}},z={class:"text-end"};const E=T({name:"ExecutorTrade",components:{Pagination:x,DynamicForm:V},data:()=>({list:null,total:0,listLoading:!0,listQuery:{page:1,size:20,name:void 0},projectOptions:[],dialogFormVisible:!1,dialogStatus:"",temp:{id:void 0,name:"",description:"",class_name:"",project_id:void 0,params:{}},rules:{name:[{required:!0,message:"请输入名称",trigger:"blur"}],class_name:[{required:!0,message:"请输入类名",trigger:"blur"}],project_id:[{required:!0,message:"请选择项目",trigger:"change"}]},executorTemplates:[],selectedTemplate:null,dynamicFormKey:0}),created(){this.getList(),this.getExecutorTemplates()},methods:{async getList(){this.listLoading=!0;try{const{data:a}=await e(this.listQuery);this.list=a,this.total=a.length}catch(a){this.$message.error("获取执行器列表失败")}this.listLoading=!1},async getExecutorTemplates(){try{const{data:e}=await a({project_id:this.temp.project_id});this.executorTemplates=e}catch(e){this.$message.error("获取执行器模板失败")}},handleFilter(){this.listQuery.page=1,this.getList()},resetTemp(){this.temp={id:void 0,name:"",description:"",class_name:"",project_id:void 0,params:{}},this.dynamicFormKey++},handleCreate(){this.resetTemp(),this.dialogStatus="create",this.dialogFormVisible=!0,this.$nextTick((()=>{this.$refs.dataForm.clearValidate()}))},handleUpdate(e){if(this.temp=Object.assign({},e),"string"==typeof this.temp.params)try{this.temp.params=JSON.parse(this.temp.params)}catch{this.temp.params={}}this.temp.params&&"object"==typeof this.temp.params||(this.temp.params={}),this.selectedTemplate=this.executorTemplates.find((e=>e.cls===this.temp.class_name)),this.dialogStatus="update",this.dialogFormVisible=!0,this.$nextTick((()=>{this.$refs.dataForm.clearValidate()}))},async createData(){this.$nextTick((()=>{this.$refs.dataForm.validate((async e=>{if(e)try{const e=Object.assign({},this.temp);await t(e),this.dialogFormVisible=!1,this.$message.success("创建成功"),this.getList()}catch(a){this.$message.error("创建执行器失败")}}))}))},async updateData(){this.$nextTick((()=>{this.$refs.dataForm.validate((async e=>{if(e)try{const e=Object.assign({},this.temp,{params:{...this.temp.params}});await l(e.id,e),this.dialogFormVisible=!1,this.$message.success("更新成功"),this.getList()}catch(a){this.$message.error("更新执行器失败")}}))}))},async handleDelete(e){try{await this.$confirm("确认删除该执行器?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await s(e.id),this.$message.success("删除成功"),this.getList()}catch(a){"cancel"!==a&&this.$message.error("删除执行器失败")}},handleTemplateChange(e){this.selectedTemplate=this.executorTemplates.find((a=>a.cls===e)),this.temp.params={},this.dynamicFormKey++},getExecutorDisplayName(e){const a=this.executorTemplates.find((a=>a.cls===e));return a?a.name:e},handleEnabledChange(e){l(e.id,{is_enabled:e.is_enabled}).then((()=>{this.$message.success(e.is_enabled?"已启用":"已禁用")})).catch((()=>{this.$message.error("状态更新失败"),e.is_enabled=!e.is_enabled}))},formatDate(e){if(!e)return"";const a=new Date(e),t=e=>e.toString().padStart(2,"0");return`${a.getFullYear()}-${t(a.getMonth()+1)}-${t(a.getDate())} ${t(a.getHours())}:${t(a.getMinutes())}:${t(a.getSeconds())}`},getExecutorTag(e){const a=this.executorTemplates.find((a=>a.cls===e));return a?a.tag:""},formatTag:e=>e}},[["render",function(e,a,t,l,s,x){const V=i("el-input"),T=i("Plus"),E=i("el-icon"),L=i("el-button"),Q=i("el-skeleton"),S=i("el-table-column"),K=i("el-tag"),O=i("el-switch"),q=i("Edit"),P=i("Delete"),N=i("el-table"),B=i("pagination"),I=i("el-card"),M=i("el-form-item"),H=i("el-option"),J=i("el-select"),Y=i("DynamicForm"),A=i("el-form"),G=i("el-dialog");return r(),o("div",w,[n(I,{shadow:"hover"},{header:d((()=>[m("div",v,[m("div",F,[m("div",$,[n(V,{modelValue:s.listQuery.name,"onUpdate:modelValue":a[0]||(a[0]=e=>s.listQuery.name=e),placeholder:"执行器名称",style:{width:"200px"},class:"filter-item",onKeyup:c(x.handleFilter,["enter"])},null,8,["modelValue","onKeyup"])]),m("div",k,[n(L,{type:"primary",onClick:x.handleCreate},{default:d((()=>[n(E,null,{default:d((()=>[n(T)])),_:1}),a[10]||(a[10]=p(" 添加执行器 "))])),_:1},8,["onClick"])])])])])),default:d((()=>[s.listLoading?(r(),o("div",C,[n(Q,{rows:4,animated:""})])):(r(),o("div",D,[n(N,{data:s.list||[],style:{width:"100%"},size:"small",border:"",fit:"","highlight-current-row":""},{default:d((()=>[n(S,{align:"center",label:"ID",width:"95"},{default:d((e=>[p(u(e.row.id),1)])),_:1}),n(S,{label:"名称"},{default:d((e=>[p(u(e.row.name),1)])),_:1}),n(S,{label:"执行器",prop:"class_name"},{default:d((({row:e})=>[p(u(x.getExecutorDisplayName(e.class_name))+" ",1),x.getExecutorTag(e.class_name)?(r(),h(K,{key:0,size:"small",type:"info",effect:"plain",style:{"margin-left":"4px","font-size":"12px",color:"#b0b3b8","border-color":"#e0e0e0"}},{default:d((()=>[p(u(x.formatTag(x.getExecutorTag(e.class_name))),1)])),_:2},1024)):g("",!0)])),_:1}),n(S,{label:"创建时间",width:"180"},{default:d((e=>[p(u(x.formatDate(e.row.created_at)),1)])),_:1}),n(S,{label:"启用",align:"center",width:"100"},{default:d((({row:e})=>[n(O,{modelValue:e.is_enabled,"onUpdate:modelValue":a=>e.is_enabled=a,"active-value":!0,"inactive-value":!1,onChange:a=>x.handleEnabledChange(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),n(S,{label:"操作",align:"center",width:"120"},{default:d((e=>[n(L,{size:"small",onClick:a=>x.handleUpdate(e.row),circle:""},{default:d((()=>[n(E,null,{default:d((()=>[n(q)])),_:1})])),_:2},1032,["onClick"]),n(L,{size:"small",type:"danger",onClick:a=>x.handleDelete(e.row),circle:""},{default:d((()=>[n(E,null,{default:d((()=>[n(P)])),_:1})])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),f(n(B,{total:s.total,page:s.listQuery.page,"onUpdate:page":a[1]||(a[1]=e=>s.listQuery.page=e),limit:s.listQuery.size,"onUpdate:limit":a[2]||(a[2]=e=>s.listQuery.size=e),onPagination:x.getList},null,8,["total","page","limit","onPagination"]),[[y,s.total>0]])])),_:1}),n(G,{title:"create"===s.dialogStatus?"创建执行器":"编辑执行器",modelValue:s.dialogFormVisible,"onUpdate:modelValue":a[9]||(a[9]=e=>s.dialogFormVisible=e),width:"700px"},{footer:d((()=>[m("div",z,[n(L,{onClick:a[7]||(a[7]=e=>s.dialogFormVisible=!1)},{default:d((()=>a[11]||(a[11]=[p("取消")]))),_:1}),n(L,{type:"primary",onClick:a[8]||(a[8]=e=>"create"===s.dialogStatus?x.createData():x.updateData())},{default:d((()=>a[12]||(a[12]=[p(" 确认 ")]))),_:1})])])),default:d((()=>[n(A,{ref:"dataForm",rules:s.rules,model:s.temp,"label-position":"right","label-width":"100px"},{default:d((()=>[n(M,{label:"名称",prop:"name"},{default:d((()=>[n(V,{modelValue:s.temp.name,"onUpdate:modelValue":a[3]||(a[3]=e=>s.temp.name=e)},null,8,["modelValue"])])),_:1}),n(M,{label:"描述",prop:"description"},{default:d((()=>[n(V,{modelValue:s.temp.description,"onUpdate:modelValue":a[4]||(a[4]=e=>s.temp.description=e),type:"textarea"},null,8,["modelValue"])])),_:1}),n(M,{label:"执行器",prop:"class_name"},{default:d((()=>[n(J,{modelValue:s.temp.class_name,"onUpdate:modelValue":a[5]||(a[5]=e=>s.temp.class_name=e),placeholder:"请选择执行器",onChange:x.handleTemplateChange,filterable:"",clearable:""},{default:d((()=>[(r(!0),o(b,null,_(s.executorTemplates,(e=>(r(),h(H,{key:e.cls,label:e.name,value:e.cls},{default:d((()=>[m("span",null,u(e.name),1),e.tag?(r(),h(K,{key:0,size:"small",type:"info",effect:"plain",style:{"margin-left":"6px","font-size":"12px",color:"#b0b3b8","border-color":"#e0e0e0"}},{default:d((()=>[p(u(x.formatTag(e.tag)),1)])),_:2},1024)):g("",!0)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1}),n(M,{label:"参数",prop:"params"},{default:d((()=>[m("div",j,[s.selectedTemplate&&s.temp.class_name?(r(),h(Y,{ref:"dynamicForm",fields:s.selectedTemplate.parameters,modelValue:s.temp.params,"onUpdate:modelValue":a[6]||(a[6]=e=>s.temp.params=e),key:s.dynamicFormKey},null,8,["fields","modelValue"])):(r(),o("div",U,"请选择执行器后填写参数"))])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["title","modelValue"])])}],["__scopeId","data-v-b198ccf9"]]);export{E as default};
