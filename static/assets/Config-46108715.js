import{u as e,r as a,b as l,m as d,c as s,o as t,d as u,e as o,f as n,w as i,n as r,p as b,g as m,q as p,E as _,s as f,i as c,F as h,t as y,v,x as V}from"./index-996b1aff.js";import{_ as w}from"./logo-42795f0e.js";import{s as k,g as q}from"./config-a0f2273b.js";import{_ as g}from"./_plugin-vue_export-helper-1b428a4d.js";const U=(e,a)=>a,K={class:"container"},x={key:0,class:"loading-container"},C={key:1,class:"form-container card"},P={class:"step-content"},S={key:0},j={key:1},F={key:2},L={key:3},M={class:"form-footer"},H=g({__name:"Config",setup(g){const H=e(),Q=a(0),E=a(!1),I=a(!1),$=l({business_db:{type:"sqlite",path:"",host:"localhost",port:3306,database:"",username:"",password:""},data_db:{type:"clickhouse",host:"localhost",port:9e3,database:"default",username:"default",password:""},admin:{username:"",password:"",confirmPassword:"",email:""}}),z=()=>{if(0===Q.value){if("sqlite"===$.business_db.type&&!$.business_db.path)return void _.error("请输入数据库路径");if("mysql"===$.business_db.type&&!($.business_db.host&&$.business_db.database&&$.business_db.username&&$.business_db.password))return void _.error("请填写所有必填字段")}else if(1===Q.value){if(!$.data_db.host||!$.data_db.username)return void _.error("请填写主机地址和用户名")}else if(2===Q.value){if(!$.admin.username||!$.admin.password)return void _.error("请填写管理员用户名和密码");if($.admin.password!==$.admin.confirmPassword)return void _.error("两次输入的密码不一致");if($.admin.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test($.admin.email))return void _.error("请输入有效的邮箱地址")}Q.value++},A=()=>{Q.value--},B=async()=>{E.value=!0;try{const e={...$};"sqlite"===e.business_db.type?(delete e.business_db.host,delete e.business_db.port,delete e.business_db.username,delete e.business_db.password,delete e.business_db.database):delete e.business_db.path,delete e.admin.confirmPassword,await k(e),_.success("配置保存成功"),H.push("/home")}catch(e){_.error("保存配置失败，请重试")}finally{E.value=!1}};return d((()=>{(async()=>{I.value=!0;try{const e=await q();U(0,e),e.business_db&&(U(0,e.business_db),$.business_db.type=e.business_db.type||"sqlite",$.business_db.path=e.business_db.path||"",$.business_db.host=e.business_db.host||"localhost",$.business_db.port=e.business_db.port||3306,$.business_db.database=e.business_db.database||"",$.business_db.username=e.business_db.username||"",$.business_db.password=e.business_db.password||"",await f(),U(0,$.business_db)),e.data_db&&(U(0,e.data_db),$.data_db.type=e.data_db.type||"clickhouse",$.data_db.host=e.data_db.host||"localhost",$.data_db.port=e.data_db.port||9e3,$.data_db.database=e.data_db.database||"default",$.data_db.username=e.data_db.username||"default",$.data_db.password=e.data_db.password||"",await f(),U(0,$.data_db)),e.admin&&(U(0,e.admin),$.admin.username=e.admin.username||"",$.admin.email=e.admin.email||"",$.admin.password="",$.admin.confirmPassword=""),e.is_configured&&(Q.value=3,U(0,{currentStep:Q.value}))}catch(e){_.error("获取配置失败，将使用默认配置")}finally{I.value=!1}})()})),(e,a)=>{const l=s("el-skeleton"),d=s("el-step"),_=s("el-steps"),f=s("el-radio"),k=s("el-radio-group"),q=s("el-form-item"),g=s("el-input"),U=s("el-form"),H=s("el-tag"),D=s("el-descriptions-item"),G=s("el-descriptions"),J=s("el-button");return t(),u("div",K,[a[33]||(a[33]=o("div",{class:"page-header"},[o("img",{src:w,alt:"Logo",class:"logo",height:"64",width:"64"}),o("h1",null,"数据库配置")],-1)),I.value?(t(),u("div",x,[n(l,{rows:10,animated:""})])):(t(),u("div",C,[n(_,{active:Q.value,"finish-status":"success",simple:""},{default:i((()=>[n(d,{title:"业务数据库"}),n(d,{title:"数据库"}),n(d,{title:"管理员账号"}),n(d,{title:"确认"})])),_:1},8,["active"]),o("div",P,[0===Q.value?(t(),u("div",S,[a[22]||(a[22]=o("h3",null,"业务数据库配置",-1)),n(U,{ref:"businessForm",model:$.business_db,"label-width":"120px",onSubmit:a[7]||(a[7]=r((()=>{}),["prevent"]))},{default:i((()=>[n(q,{label:"数据库类型"},{default:i((()=>[n(k,{modelValue:$.business_db.type,"onUpdate:modelValue":a[0]||(a[0]=e=>$.business_db.type=e)},{default:i((()=>[n(f,{value:"sqlite"},{default:i((()=>a[20]||(a[20]=[c("SQLite")]))),_:1}),n(f,{value:"mysql"},{default:i((()=>a[21]||(a[21]=[c("MySQL")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),"sqlite"===$.business_db.type?(t(),p(q,{key:0,label:"数据库路径",required:""},{default:i((()=>[n(g,{modelValue:$.business_db.path,"onUpdate:modelValue":a[1]||(a[1]=e=>$.business_db.path=e),placeholder:"/path/to/your/database.db",onKeyup:m(z,["enter","native"])},null,8,["modelValue"])])),_:1})):b("",!0),"mysql"===$.business_db.type?(t(),u(h,{key:1},[n(q,{label:"主机地址",required:""},{default:i((()=>[n(g,{modelValue:$.business_db.host,"onUpdate:modelValue":a[2]||(a[2]=e=>$.business_db.host=e),placeholder:"localhost",onKeyup:m(z,["enter","native"])},null,8,["modelValue"])])),_:1}),n(q,{label:"端口",required:""},{default:i((()=>[n(g,{modelValue:$.business_db.port,"onUpdate:modelValue":a[3]||(a[3]=e=>$.business_db.port=e),modelModifiers:{number:!0},placeholder:"3306",type:"number",onKeyup:m(z,["enter","native"])},null,8,["modelValue"])])),_:1}),n(q,{label:"数据库名",required:""},{default:i((()=>[n(g,{modelValue:$.business_db.database,"onUpdate:modelValue":a[4]||(a[4]=e=>$.business_db.database=e),placeholder:"database_name",onKeyup:m(z,["enter","native"])},null,8,["modelValue"])])),_:1}),n(q,{label:"用户名",required:""},{default:i((()=>[n(g,{modelValue:$.business_db.username,"onUpdate:modelValue":a[5]||(a[5]=e=>$.business_db.username=e),placeholder:"username",onKeyup:m(z,["enter","native"])},null,8,["modelValue"])])),_:1}),n(q,{label:"密码",required:""},{default:i((()=>[n(g,{modelValue:$.business_db.password,"onUpdate:modelValue":a[6]||(a[6]=e=>$.business_db.password=e),placeholder:"password",type:"password",onKeyup:m(z,["enter","native"])},null,8,["modelValue"])])),_:1})],64)):b("",!0)])),_:1},8,["model"])])):b("",!0),1===Q.value?(t(),u("div",j,[a[24]||(a[24]=o("h3",null,"数据库配置 (ClickHouse)",-1)),n(U,{ref:"dataForm",model:$.data_db,"label-width":"120px",onSubmit:a[14]||(a[14]=r((()=>{}),["prevent"]))},{default:i((()=>[n(q,{label:"数据库类型"},{default:i((()=>[n(H,null,{default:i((()=>a[23]||(a[23]=[c("ClickHouse")]))),_:1}),y(o("input",{type:"hidden","onUpdate:modelValue":a[8]||(a[8]=e=>$.data_db.type=e),value:"clickhouse"},null,512),[[v,$.data_db.type]])])),_:1}),n(q,{label:"主机地址",required:""},{default:i((()=>[n(g,{modelValue:$.data_db.host,"onUpdate:modelValue":a[9]||(a[9]=e=>$.data_db.host=e),placeholder:"localhost",onKeyup:m(z,["enter","native"])},null,8,["modelValue"])])),_:1}),n(q,{label:"端口",required:""},{default:i((()=>[n(g,{modelValue:$.data_db.port,"onUpdate:modelValue":a[10]||(a[10]=e=>$.data_db.port=e),modelModifiers:{number:!0},placeholder:"9000",type:"number",onKeyup:m(z,["enter","native"])},null,8,["modelValue"])])),_:1}),n(q,{label:"数据库名"},{default:i((()=>[n(g,{modelValue:$.data_db.database,"onUpdate:modelValue":a[11]||(a[11]=e=>$.data_db.database=e),placeholder:"default",onKeyup:m(z,["enter","native"])},null,8,["modelValue"])])),_:1}),n(q,{label:"用户名",required:""},{default:i((()=>[n(g,{modelValue:$.data_db.username,"onUpdate:modelValue":a[12]||(a[12]=e=>$.data_db.username=e),placeholder:"username",onKeyup:m(z,["enter","native"])},null,8,["modelValue"])])),_:1}),n(q,{label:"密码"},{default:i((()=>[n(g,{modelValue:$.data_db.password,"onUpdate:modelValue":a[13]||(a[13]=e=>$.data_db.password=e),placeholder:"password",type:"password",onKeyup:m(z,["enter","native"])},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])):b("",!0),2===Q.value?(t(),u("div",F,[a[25]||(a[25]=o("h3",null,"管理员账号配置",-1)),n(U,{ref:"adminForm",model:$.admin,"label-width":"120px",onSubmit:a[19]||(a[19]=r((()=>{}),["prevent"]))},{default:i((()=>[n(q,{label:"用户名",required:""},{default:i((()=>[n(g,{modelValue:$.admin.username,"onUpdate:modelValue":a[15]||(a[15]=e=>$.admin.username=e),placeholder:"请输入管理员用户名",onKeyup:m(z,["enter","native"])},null,8,["modelValue"])])),_:1}),n(q,{label:"密码",required:""},{default:i((()=>[n(g,{modelValue:$.admin.password,"onUpdate:modelValue":a[16]||(a[16]=e=>$.admin.password=e),type:"password",placeholder:"请输入管理员密码","show-password":"",onKeyup:m(z,["enter","native"])},null,8,["modelValue"])])),_:1}),n(q,{label:"确认密码",required:""},{default:i((()=>[n(g,{modelValue:$.admin.confirmPassword,"onUpdate:modelValue":a[17]||(a[17]=e=>$.admin.confirmPassword=e),type:"password",placeholder:"请再次输入密码","show-password":"",onKeyup:m(z,["enter","native"])},null,8,["modelValue"])])),_:1}),n(q,{label:"邮箱"},{default:i((()=>[n(g,{modelValue:$.admin.email,"onUpdate:modelValue":a[18]||(a[18]=e=>$.admin.email=e),placeholder:"请输入管理员邮箱（可选）",onKeyup:m(z,["enter","native"])},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])):b("",!0),3===Q.value?(t(),u("div",L,[a[28]||(a[28]=o("h3",null,"配置摘要",-1)),o("div",{tabindex:"0",onKeyup:m(B,["enter"])},[n(G,{title:"业务数据库",column:1,border:""},{default:i((()=>[n(D,{label:"类型"},{default:i((()=>[c(V($.business_db.type),1)])),_:1}),"sqlite"===$.business_db.type?(t(),p(D,{key:0,label:"路径"},{default:i((()=>[c(V($.business_db.path),1)])),_:1})):(t(),u(h,{key:1},[n(D,{label:"主机地址"},{default:i((()=>[c(V($.business_db.host),1)])),_:1}),n(D,{label:"端口"},{default:i((()=>[c(V($.business_db.port),1)])),_:1}),n(D,{label:"数据库名"},{default:i((()=>[c(V($.business_db.database),1)])),_:1}),n(D,{label:"用户名"},{default:i((()=>[c(V($.business_db.username),1)])),_:1}),n(D,{label:"密码"},{default:i((()=>a[26]||(a[26]=[c("******")]))),_:1})],64))])),_:1}),n(G,{title:"数据库",column:1,border:"",class:"mt-20"},{default:i((()=>[n(D,{label:"类型"},{default:i((()=>[c(V($.data_db.type),1)])),_:1}),n(D,{label:"主机地址"},{default:i((()=>[c(V($.data_db.host),1)])),_:1}),n(D,{label:"端口"},{default:i((()=>[c(V($.data_db.port),1)])),_:1}),n(D,{label:"数据库名"},{default:i((()=>[c(V($.data_db.database),1)])),_:1}),n(D,{label:"用户名"},{default:i((()=>[c(V($.data_db.username),1)])),_:1}),n(D,{label:"密码"},{default:i((()=>a[27]||(a[27]=[c("******")]))),_:1})])),_:1}),n(G,{title:"管理员账号",column:1,border:"",class:"mt-20"},{default:i((()=>[n(D,{label:"用户名"},{default:i((()=>[c(V($.admin.username),1)])),_:1}),n(D,{label:"邮箱"},{default:i((()=>[c(V($.admin.email||"未设置"),1)])),_:1})])),_:1})],32)])):b("",!0)]),o("div",M,[Q.value>0?(t(),p(J,{key:0,onClick:A},{default:i((()=>a[29]||(a[29]=[c("上一步")]))),_:1})):b("",!0),a[32]||(a[32]=o("div",{class:"spacer"},null,-1)),Q.value<3?(t(),p(J,{key:1,type:"primary",onClick:z},{default:i((()=>a[30]||(a[30]=[c("下一步")]))),_:1})):b("",!0),3===Q.value?(t(),p(J,{key:2,type:"success",onClick:B,loading:E.value},{default:i((()=>a[31]||(a[31]=[c(" 保存配置 ")]))),_:1},8,["loading"])):b("",!0)])]))])}}},[["__scopeId","data-v-d0091ae9"]]);export{H as default};
