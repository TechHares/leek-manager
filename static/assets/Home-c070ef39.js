import{a as e,y as l,c as a,o as t,d as o,e as u,t as d,z as s,f as n,w as r,h as i,i as p,A as c,B as m,C as f,D as v,G as _,H as h,I as g,J as b,K as w,L as y,u as V,r as x,m as k,M as U,N as S,F as C,O as j,q as z,p as P,x as I,P as L,E as q,Q as $,R as E,S as O,T as R,U as F,V as Q,b as T,W,X as B,Y as H,Z as D,_ as K,$ as M}from"./index-996b1aff.js";import{_ as A}from"./logo-42795f0e.js";import{_ as G}from"./_plugin-vue_export-helper-1b428a4d.js";import{f as J}from"./format-76ff4d5a.js";const N={class:"logo-container"},X={class:"logo-text-wrapper"},Y=G({__name:"Sidebar",props:{collapsed:{type:Boolean,default:!1}},emits:["update:collapsed"],setup(y,{emit:V}){const x=e();return l((()=>x.path)),(e,l)=>{const V=a("el-icon"),x=a("el-menu-item"),k=a("el-sub-menu"),U=a("Setting"),S=a("el-menu");return t(),o("div",{class:c(["sidebar",{"sidebar-collapsed":y.collapsed}])},[u("div",N,[u("div",X,[l[0]||(l[0]=u("img",{src:A,alt:"Logo",class:"logo",height:"32",width:"32"},null,-1)),d(u("h1",null,"量韭",512),[[s,!y.collapsed]])])]),n(S,{"default-active":e.$route.path,router:!0,class:"sidebar-menu",collapse:y.collapsed,"background-color":"#304156","text-color":"#bfcbd9","active-text-color":"#409EFF"},{default:r((()=>[n(k,{index:"dashboard"},{title:r((()=>[n(V,null,{default:r((()=>[n(i(m))])),_:1}),l[1]||(l[1]=u("span",null,"仪表盘",-1))])),default:r((()=>[n(x,{index:"/dashboard/assets"},{default:r((()=>l[2]||(l[2]=[p("资产")]))),_:1}),n(x,{index:"/dashboard/strategy"},{default:r((()=>l[3]||(l[3]=[p("策略")]))),_:1})])),_:1}),n(k,{index:"asset"},{title:r((()=>[n(V,null,{default:r((()=>[n(i(f))])),_:1}),l[4]||(l[4]=u("span",null,"资产",-1))])),default:r((()=>[n(x,{index:"/asset/position"},{default:r((()=>l[5]||(l[5]=[p("仓位")]))),_:1}),n(x,{index:"/asset/position_setting"},{default:r((()=>l[6]||(l[6]=[p("仓位设置")]))),_:1})])),_:1}),n(k,{index:"datasource"},{title:r((()=>[n(V,null,{default:r((()=>[n(i(v))])),_:1}),l[7]||(l[7]=u("span",null,"数据源",-1))])),default:r((()=>[n(x,{index:"/datasource/datasource"},{default:r((()=>l[8]||(l[8]=[p("数据源管理")]))),_:1}),n(x,{index:"/datasource/datastrategy"},{default:r((()=>l[9]||(l[9]=[p("数据源策略")]))),_:1})])),_:1}),n(k,{index:"executor"},{title:r((()=>[n(V,null,{default:r((()=>[n(i(_))])),_:1}),l[10]||(l[10]=u("span",null,"交易器",-1))])),default:r((()=>[n(x,{index:"/executor/trade"},{default:r((()=>l[11]||(l[11]=[p("交易器管理")]))),_:1}),n(x,{index:"/executor/exe_order"},{default:r((()=>l[12]||(l[12]=[p("交易器订单")]))),_:1}),n(x,{index:"/executor/order"},{default:r((()=>l[13]||(l[13]=[p("交易所订单")]))),_:1}),n(x,{index:"/executor/config"},{default:r((()=>l[14]||(l[14]=[p("交易器设置")]))),_:1})])),_:1}),n(k,{index:"strategy"},{title:r((()=>[n(V,null,{default:r((()=>[n(i(h))])),_:1}),l[15]||(l[15]=u("span",null,"策略",-1))])),default:r((()=>[n(x,{index:"/strategy/strategy"},{default:r((()=>l[16]||(l[16]=[p("策略管理")]))),_:1}),n(x,{index:"/strategy/signal"},{default:r((()=>l[17]||(l[17]=[p("策略信号")]))),_:1}),n(x,{index:"/strategy/backtest"},{default:r((()=>l[18]||(l[18]=[p("策略回测")]))),_:1})])),_:1}),n(k,{index:"model"},{title:r((()=>[n(V,null,{default:r((()=>[n(i(g))])),_:1}),l[19]||(l[19]=u("span",null,"模型",-1))])),default:r((()=>[n(x,{index:"/model/training"},{default:r((()=>l[20]||(l[20]=[p("模型训练")]))),_:1}),n(x,{index:"/model/online"},{default:r((()=>l[21]||(l[21]=[p("模型上线")]))),_:1})])),_:1}),n(k,{index:"scheduler"},{title:r((()=>[n(V,null,{default:r((()=>[n(i(b))])),_:1}),l[22]||(l[22]=u("span",null,"调度",-1))])),default:r((()=>[n(x,{index:"/scheduler/download"},{default:r((()=>l[23]||(l[23]=[p("数据下载")]))),_:1}),n(x,{index:"/scheduler/risk"},{default:r((()=>l[24]||(l[24]=[p("风控")]))),_:1})])),_:1}),n(k,{index:"authorization"},{title:r((()=>[n(V,null,{default:r((()=>[n(i(w))])),_:1}),l[25]||(l[25]=u("span",null,"角色与授权",-1))])),default:r((()=>[n(x,{index:"/authorization/user"},{default:r((()=>l[26]||(l[26]=[p("用户管理")]))),_:1}),n(x,{index:"/authorization/role"},{default:r((()=>l[27]||(l[27]=[p("角色管理")]))),_:1})])),_:1}),n(x,{index:"/setting"},{default:r((()=>[n(V,null,{default:r((()=>[n(U)])),_:1}),l[28]||(l[28]=u("span",null,"系统设置",-1))])),_:1})])),_:1},8,["default-active","collapse"])],2)}}},[["__scopeId","data-v-92ef2600"]]);const Z={class:"header"},ee={class:"header-left"},le={class:"header-right"},ae={class:"user-dropdown"},te={key:0,class:"username"},oe={class:"project-management"},ue={class:"project-header"},de=G({__name:"Header",props:{currentUser:{type:Object,default:null},isSmallScreen:{type:Boolean,default:!1}},emits:["toggle-sidebar","logout","open-profile","openSystemConfig"],setup(e){const s=V(),c=e,m=l((()=>c.currentUser&&(!0===c.currentUser.is_admin||1===c.currentUser.is_admin||"true"===c.currentUser.is_admin||"1"===c.currentUser.is_admin||"yes"===c.currentUser.is_admin))),f=()=>{s.push("/config")},v=x(!1),_=x(!1),h=x("create"),g=x(!1),b=x(!1),w=x([]),T=x(null),W=x(null),B=x({name:"",description:""}),H={name:[{required:!0,message:"请输入项目名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],description:[{max:200,message:"描述不能超过200个字符",trigger:"blur"}]},D=async()=>{const e=await y.get("/projects");w.value=e.data||[];const l=localStorage.getItem("current_project_id");l&&w.value.some((e=>String(e.id)===String(l)))?W.value=String(l):w.value.length>0?(W.value=String(w.value[0].id),localStorage.setItem("current_project_id",String(w.value[0].id))):(W.value=null,localStorage.removeItem("current_project_id"),v.value=!0)},K=()=>{h.value="create",B.value={name:"",description:""},_.value=!0},M=async e=>{try{await L.confirm("确定要删除该项目吗？","提示",{type:"warning"}),await(l=e.id,y.delete(`/projects/${l}`)),q.success("删除成功"),D()}catch(a){"cancel"!==a&&q.error("删除失败")}var l},A=async()=>{T.value&&await T.value.validate((async e=>{if(e){b.value=!0;try{"create"===h.value?(await(l=B.value,y.post("/projects",l)),q.success("创建成功")):(await function(e,l){return y.put(`/projects/${e}`,l)}(B.value.id,B.value),q.success("更新成功")),_.value=!1,D()}catch(a){q.error("create"===h.value?"创建失败":"更新失败")}finally{b.value=!1}}var l}))},G=()=>{v.value=!0},N=e=>{localStorage.setItem("current_project_id",String(e)),window.location.reload()};return k((()=>{D()})),U(v,(e=>{e&&D()})),(l,s)=>{const c=a("el-icon"),y=a("el-option"),V=a("el-select"),x=a("el-avatar"),k=a("el-dropdown-item"),U=a("el-dropdown-menu"),L=a("el-dropdown"),q=a("el-button"),D=a("el-table-column"),X=a("el-button-group"),Y=a("el-table"),de=a("el-input"),se=a("el-form-item"),ne=a("el-form"),re=a("el-dialog"),ie=S("loading");return t(),o(C,null,[u("div",Z,[u("div",ee,[n(c,{class:"menu-toggle",onClick:s[0]||(s[0]=e=>l.$emit("toggle-sidebar"))},{default:r((()=>[n(i($))])),_:1}),n(V,{modelValue:W.value,"onUpdate:modelValue":s[1]||(s[1]=e=>W.value=e),placeholder:"请选择项目",style:{"font-size":"22px","font-weight":"bold","min-width":"100px","margin-left":"10px"},onChange:N,filterable:""},{default:r((()=>[(t(!0),o(C,null,j(w.value,(e=>(t(),z(y,{key:e.id,label:e.name,value:String(e.id)},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),u("div",le,[e.currentUser?(t(),z(L,{key:0,trigger:"click"},{dropdown:r((()=>[n(U,null,{default:r((()=>[n(k,{onClick:s[2]||(s[2]=e=>l.$emit("open-profile"))},{default:r((()=>[n(c,null,{default:r((()=>[n(i(E))])),_:1}),s[9]||(s[9]=u("span",null,"个人信息",-1))])),_:1}),m.value?(t(),z(k,{key:0,onClick:f},{default:r((()=>[n(c,null,{default:r((()=>[n(i(O))])),_:1}),s[10]||(s[10]=u("span",null,"数据库配置",-1))])),_:1})):P("",!0),m.value?(t(),z(k,{key:1,onClick:G},{default:r((()=>[n(c,null,{default:r((()=>[n(i(O))])),_:1}),s[11]||(s[11]=u("span",null,"项目管理",-1))])),_:1})):P("",!0),n(k,{divided:"",onClick:s[3]||(s[3]=e=>l.$emit("logout"))},{default:r((()=>[n(c,null,{default:r((()=>[n(i(R))])),_:1}),s[12]||(s[12]=u("span",null,"退出登录",-1))])),_:1})])),_:1})])),default:r((()=>[u("div",ae,[n(x,{size:32,icon:i(E)},null,8,["icon"]),e.isSmallScreen?P("",!0):(t(),o("span",te,I(e.currentUser.username),1)),n(c,null,{default:r((()=>[n(i(F))])),_:1})])])),_:1})):P("",!0)])]),n(re,{modelValue:v.value,"onUpdate:modelValue":s[8]||(s[8]=e=>v.value=e),title:"项目管理",width:"800px"},{default:r((()=>[u("div",oe,[u("div",ue,[n(q,{type:"primary",onClick:K},{default:r((()=>[n(c,null,{default:r((()=>[n(i(Q))])),_:1}),s[13]||(s[13]=p("新建项目 "))])),_:1})]),d((t(),z(Y,{data:w.value,style:{width:"100%"}},{default:r((()=>[n(D,{prop:"name",label:"项目名称"}),n(D,{prop:"description",label:"描述","show-overflow-tooltip":""}),n(D,{prop:"created_at",label:"创建时间",width:"180"},{default:r((e=>[p(I(i(J)(e.row.created_at)),1)])),_:1}),n(D,{label:"操作",width:"150",fixed:"right"},{default:r((e=>[n(X,null,{default:r((()=>[n(q,{type:"primary",link:"",onClick:l=>{return a=e.row,h.value="edit",B.value={...a},void(_.value=!0);var a}},{default:r((()=>s[14]||(s[14]=[p(" 编辑 ")]))),_:2},1032,["onClick"]),n(q,{type:"danger",link:"",onClick:l=>M(e.row)},{default:r((()=>s[15]||(s[15]=[p(" 删除 ")]))),_:2},1032,["onClick"])])),_:2},1024)])),_:1})])),_:1},8,["data"])),[[ie,g.value]])]),n(re,{modelValue:_.value,"onUpdate:modelValue":s[7]||(s[7]=e=>_.value=e),title:"create"===h.value?"新建项目":"编辑项目",width:"500px","append-to-body":""},{footer:r((()=>[n(q,{onClick:s[6]||(s[6]=e=>_.value=!1)},{default:r((()=>s[16]||(s[16]=[p("取消")]))),_:1}),n(q,{type:"primary",onClick:A,loading:b.value},{default:r((()=>s[17]||(s[17]=[p(" 确定 ")]))),_:1},8,["loading"])])),default:r((()=>[n(ne,{ref_key:"projectFormRef",ref:T,model:B.value,rules:H,"label-width":"80px"},{default:r((()=>[n(se,{label:"项目名称",prop:"name"},{default:r((()=>[n(de,{modelValue:B.value.name,"onUpdate:modelValue":s[4]||(s[4]=e=>B.value.name=e),placeholder:"请输入项目名称"},null,8,["modelValue"])])),_:1}),n(se,{label:"描述",prop:"description"},{default:r((()=>[n(de,{modelValue:B.value.description,"onUpdate:modelValue":s[5]||(s[5]=e=>B.value.description=e),type:"textarea",placeholder:"请输入项目描述"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"])])),_:1},8,["modelValue"])],64)}}},[["__scopeId","data-v-51f4ddca"]]),se={class:"app-container"},ne={key:0,class:"loading-container"},re={key:1,class:"dashboard-layout"},ie={class:"main-content"},pe={class:"content-wrapper"},ce={class:"tab-bar-bg"},me={class:"dialog-footer"},fe={class:"dialog-footer"},ve=G({__name:"Home",setup(d){const s=V(),i=e(),c=x(!0),m=x(null),f=x(!1),v=x(!1),_=x(!1),h=x(window.innerWidth<768),g=x([{title:"首页",path:"/",closable:!1}]),b=x(i.path);function w(e){return e.meta&&e.meta.title?e.meta.title:"/"===e.path?"首页":"/authorization/user"===e.path?"用户管理":"/authorization/role"===e.path?"角色管理":"/config"===e.path?"系统设置":e.name||e.path}function y(e){const l=g.value.findIndex((l=>l.path===e));if(-1!==l&&(g.value.splice(l,1),b.value===e)){const e=g.value[l]||g.value[l-1]||g.value[0];e&&s.push(e.path)}}function S(e){e.props.name!==i.path&&s.push(e.props.name)}U((()=>i.path),(e=>{var l;l=i,g.value.find((e=>e.path===l.path))||g.value.push({title:w(l),path:l.path,closable:"/"!==l.path}),b.value=l.path}),{immediate:!0});const P=T({username:"",email:"",password:"",confirmPassword:""}),I=T({type:"sqlite",path:"",host:"localhost",port:3306,database:"",username:"",password:""});l((()=>({"/":"仪表盘","/dashboard/system":"系统仪表盘","/dashboard/assets":"资产仪表盘","/dashboard/strategy":"策略仪表盘","/settings":"系统设置"}[i.path]||"LEEK")));const L=()=>{h.value=window.innerWidth<768,window.innerWidth<992&&!f.value&&(f.value=!0)},$=()=>{f.value=!f.value},E=()=>{B(),s.push("/login")},O=()=>{m.value&&(P.username=m.value.username,P.email=m.value.email||"",P.password="",P.confirmPassword=""),v.value=!0},R=async()=>{if(P.password===P.confirmPassword)try{q.success("个人信息更新成功"),v.value=!1,m.value&&(m.value.email=P.email)}catch(e){q.error("更新个人信息失败")}else q.error("两次输入的密码不一致")},F=()=>{_.value=!0},Q=async()=>{try{q.success("数据库配置保存成功"),_.value=!1}catch(e){q.error("保存数据库配置失败")}};return k((()=>{(async()=>{if(H())try{if(s.currentRoute.value.meta.userVerified){const e=s.currentRoute.value.meta.userData;return m.value=e,e&&!e.hasOwnProperty("is_admin")&&(m.value.is_admin=!1),void(c.value=!1)}const e=await D();if(!e)return void s.push("/login");m.value=e,e.hasOwnProperty("is_admin")||(m.value.is_admin=!1),c.value=!1}catch(e){s.push("/login")}else s.push("/login")})(),window.addEventListener("resize",L),L()})),W((()=>{window.removeEventListener("resize",L)})),(e,l)=>{const d=a("el-skeleton"),s=a("el-tab-pane"),i=a("el-tabs"),w=a("router-view"),V=a("el-input"),x=a("el-form-item"),k=a("el-form"),U=a("el-button"),L=a("el-dialog"),q=a("el-option"),T=a("el-select"),W=a("el-input-number");return t(),o("div",se,[c.value?(t(),o("div",ne,[n(d,{rows:4,animated:""})])):(t(),o("div",re,[n(Y,{collapsed:f.value,"onUpdate:collapsed":l[0]||(l[0]=e=>f.value=e)},null,8,["collapsed"]),u("div",ie,[n(de,{"current-user":m.value,"is-small-screen":h.value,onToggleSidebar:$,onLogout:E,onOpenProfile:O,onOpenSystemConfig:F},null,8,["current-user","is-small-screen"]),u("div",pe,[u("div",ce,[n(i,{modelValue:b.value,"onUpdate:modelValue":l[1]||(l[1]=e=>b.value=e),type:"card",onTabClick:S,onTabRemove:y,closable:"",class:"custom-tabs"},{default:r((()=>[(t(!0),o(C,null,j(g.value,(e=>(t(),z(s,{key:e.path,label:e.title,name:e.path,closable:e.closable},null,8,["label","name","closable"])))),128))])),_:1},8,["modelValue"])]),n(w,null,{default:r((({Component:e})=>[(t(),z(M,null,[(t(),z(K(e)))],1024))])),_:1})])])])),n(L,{modelValue:v.value,"onUpdate:modelValue":l[7]||(l[7]=e=>v.value=e),title:"编辑个人信息",width:"500px"},{footer:r((()=>[u("span",me,[n(U,{onClick:l[6]||(l[6]=e=>v.value=!1)},{default:r((()=>l[17]||(l[17]=[p("取消")]))),_:1}),n(U,{type:"primary",onClick:R},{default:r((()=>l[18]||(l[18]=[p(" 保存 ")]))),_:1})])])),default:r((()=>[n(k,{model:P,"label-width":"100px"},{default:r((()=>[n(x,{label:"用户名"},{default:r((()=>[n(V,{modelValue:P.username,"onUpdate:modelValue":l[2]||(l[2]=e=>P.username=e),disabled:""},null,8,["modelValue"])])),_:1}),n(x,{label:"邮箱"},{default:r((()=>[n(V,{modelValue:P.email,"onUpdate:modelValue":l[3]||(l[3]=e=>P.email=e)},null,8,["modelValue"])])),_:1}),n(x,{label:"新密码"},{default:r((()=>[n(V,{modelValue:P.password,"onUpdate:modelValue":l[4]||(l[4]=e=>P.password=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1}),n(x,{label:"确认密码"},{default:r((()=>[n(V,{modelValue:P.confirmPassword,"onUpdate:modelValue":l[5]||(l[5]=e=>P.confirmPassword=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"]),n(L,{modelValue:_.value,"onUpdate:modelValue":l[16]||(l[16]=e=>_.value=e),title:"数据库配置",width:"500px"},{footer:r((()=>[u("span",fe,[n(U,{onClick:l[15]||(l[15]=e=>_.value=!1)},{default:r((()=>l[19]||(l[19]=[p("取消")]))),_:1}),n(U,{type:"primary",onClick:Q},{default:r((()=>l[20]||(l[20]=[p(" 保存 ")]))),_:1})])])),default:r((()=>[n(k,{model:I,"label-width":"120px"},{default:r((()=>[n(x,{label:"数据库类型"},{default:r((()=>[n(T,{modelValue:I.type,"onUpdate:modelValue":l[8]||(l[8]=e=>I.type=e),placeholder:"请选择数据库类型"},{default:r((()=>[n(q,{label:"SQLite",value:"sqlite"}),n(q,{label:"MySQL",value:"mysql"}),n(q,{label:"PostgreSQL",value:"postgresql"})])),_:1},8,["modelValue"])])),_:1}),"sqlite"===I.type?(t(),z(x,{key:0,label:"数据库路径"},{default:r((()=>[n(V,{modelValue:I.path,"onUpdate:modelValue":l[9]||(l[9]=e=>I.path=e),placeholder:"/path/to/database.db"},null,8,["modelValue"])])),_:1})):(t(),o(C,{key:1},[n(x,{label:"数据库主机"},{default:r((()=>[n(V,{modelValue:I.host,"onUpdate:modelValue":l[10]||(l[10]=e=>I.host=e),placeholder:"localhost"},null,8,["modelValue"])])),_:1}),n(x,{label:"端口"},{default:r((()=>[n(W,{modelValue:I.port,"onUpdate:modelValue":l[11]||(l[11]=e=>I.port=e),min:1,max:65535},null,8,["modelValue"])])),_:1}),n(x,{label:"数据库名称"},{default:r((()=>[n(V,{modelValue:I.database,"onUpdate:modelValue":l[12]||(l[12]=e=>I.database=e),placeholder:"database_name"},null,8,["modelValue"])])),_:1}),n(x,{label:"用户名"},{default:r((()=>[n(V,{modelValue:I.username,"onUpdate:modelValue":l[13]||(l[13]=e=>I.username=e),placeholder:"username"},null,8,["modelValue"])])),_:1}),n(x,{label:"密码"},{default:r((()=>[n(V,{modelValue:I.password,"onUpdate:modelValue":l[14]||(l[14]=e=>I.password=e),type:"password",placeholder:"password","show-password":""},null,8,["modelValue"])])),_:1})],64))])),_:1},8,["model"])])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-7fd69c7f"]]);export{ve as default};
