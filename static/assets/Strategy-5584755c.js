import{g as e,u as t,a,b as l,c as s,d as i,e as r,f as n,r as o,h as c,i as d,j as m,k as p,l as u}from"./strategy-757b8677.js";import{g,a as f,f as y}from"./datasource-54b16d5f.js";import{L as _,c as h,o as b,q as S,w as k,d as x,f as v,F as C,O as D,p as T,e as w,i as V,x as P,g as I,t as F,z as E,A as z,n as U}from"./index-996b1aff.js";import{P as R}from"./index-e7ada867.js";import{a as $,f as L,b as O}from"./format-76ff4d5a.js";import{s as A,e as j,b as K}from"./enum-9649b8be.js";import{c as B}from"./position-ad296b53.js";import{_ as M}from"./_plugin-vue_export-helper-1b428a4d.js";import{g as q}from"./executor-c862610e.js";import{D as H}from"./DynamicForm-adccf113.js";const N={name:"StrategyDataViewer",props:{visible:{type:Boolean,default:!1},strategyId:{type:Number,required:!0}},emits:["update:visible"],data:()=>({selectedInstanceId:null,currentInstanceData:null,strategyData:null,editingStrategyStateKey:null,editingStrategyStateValue:"",timer:null}),computed:{dialogVisible:{get(){return this.visible},set(e){this.$emit("update:visible",e)}},strategyInstanceIds(){return this.strategyData&&this.strategyData.data?Object.keys(this.strategyData.data):[]}},mounted(){this.fetchStrategy(),this.timer||(this.timer=setInterval(this.fetchStrategy,8e3))},beforeUnmount(){this.timer&&(clearInterval(this.timer),this.timer=null)},methods:{formatNumber:$,sideZh:A,getPositionSideTag:j,insTypeDesc:K,async fetchStrategy(){try{const t=await e(this.strategyId);this.strategyData=t.data,this.strategyInstanceIds.length>0&&(this.selectedInstanceId=this.strategyInstanceIds[0],this.handleInstanceChange())}catch(t){this.strategyData=null}},handleInstanceChange(){this.selectedInstanceId&&this.strategyData&&this.strategyData.data?this.currentInstanceData=this.strategyData.data[this.selectedInstanceId]:this.currentInstanceData=null},calcSz:e=>e.executor_sz?Object.values(e.executor_sz).reduce(((e,t)=>e+Number(t)),0):0,async handleClosePosition(e){try{await this.$confirm("确认平仓该仓位(平仓不会立即修改仓位状态，需要等待策略执行器处理，请勿重复点击)?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await B(e.position_id),this.$message.success("平仓成功"),this.fetchStrategy()}catch(t){"cancel"!==t&&this.$message.error("平仓失败")}},getStateTagType(e){if(!e)return"info";switch(e.toLowerCase()){case"ready":return"success";case"running":return"warning";case"stopped":case"error":return"danger";default:return"info"}},handleClose(){this.selectedInstanceId=null,this.currentInstanceData=null,this.strategyData=null},startEditStrategyState(e,t){this.editingStrategyStateKey=e,this.editingStrategyStateValue=t},async saveStrategyState(e){this.currentInstanceData.strategy_state[e]=this.editingStrategyStateValue,await t(this.strategyId,this.strategyData.data),this.editingStrategyStateKey=null,this.editingStrategyStateValue=""}}},Q={key:0,class:"empty-state"},Z={key:1},G={key:0,class:"instance-selector"},J={key:1,class:"empty-text"},W={key:1,class:"empty-text"},X={key:0},Y={key:1,class:"empty-text"},ee={key:0},te={class:"desc-key-fixed"},ae=["onClick"],le={key:1,class:"desc-value-fixed"},se={key:1,class:"empty-text"};const ie={class:"strategy-page"},re={class:"header-bar"},ne={class:"table-actions"},oe={class:"left-actions"},ce={style:{display:"flex","align-items":"center",gap:"12px"}},de={class:"right-actions"},me={key:0,class:"text-center py-4"},pe={key:1},ue=["innerHTML"],ge=["innerHTML"],fe={key:1},ye=["innerHTML"],_e={key:1},he={class:"param-scroll-area"},be={key:1,style:{color:"#b0b3b8"}},Se={class:"data-source-list scrollable-policy-list"},ke=["onClick"],xe={style:{"text-align":"left","font-size":"14px","line-height":"20px"}},ve={key:0,style:{color:"#b0b3b8","text-align":"center","margin-top":"40px"}},Ce={key:1,style:{color:"#b0b3b8"}},De={key:1,style:{color:"#b0b3b8",padding:"24px"}},Te={key:0,class:"position-config-box"},we={class:"policy-list scrollable-policy-list"},Ve=["onClick"],Pe=["innerHTML"],Ie={key:1},Fe={key:0,style:{color:"#b0b3b8","text-align":"center","margin-top":"40px"}},Ee={key:1,style:{color:"#b0b3b8"}},ze={key:1,style:{color:"#b0b3b8",padding:"24px"}},Ue={key:0,class:"position-config-box"},Re={class:"param-scroll-area"},$e={key:1,style:{color:"#b0b3b8"}},Le={class:"param-scroll-area"},Oe={key:1,style:{color:"#b0b3b8"}},Ae={class:"policy-list scrollable-policy-list"},je=["onClick"],Ke=["innerHTML"],Be={key:1},Me={key:0,style:{color:"#b0b3b8","text-align":"center","margin-top":"40px"}},qe={key:1,style:{color:"#b0b3b8",padding:"24px"}},He={class:"text-end"};const Ne=M({name:"Strategy",components:{Pagination:R,DynamicForm:H,StrategyDataViewer:M(N,[["render",function(e,t,a,l,s,i){const r=h("el-empty"),n=h("el-option"),o=h("el-select"),c=h("el-tag"),d=h("el-descriptions-item"),m=h("el-table-column"),p=h("Minus"),u=h("el-icon"),g=h("el-button"),f=h("el-tooltip"),y=h("el-table"),_=h("el-input"),F=h("el-descriptions"),E=h("el-dialog");return b(),S(E,{title:"策略数据",modelValue:i.dialogVisible,"onUpdate:modelValue":t[3]||(t[3]=e=>i.dialogVisible=e),width:"1000px",onClose:i.handleClose,class:"strategy-data-viewer"},{default:k((()=>[s.strategyData&&0!==Object.keys(s.strategyData).length?(b(),x("div",Z,[i.strategyInstanceIds.length>1?(b(),x("div",G,[v(o,{modelValue:s.selectedInstanceId,"onUpdate:modelValue":t[0]||(t[0]=e=>s.selectedInstanceId=e),placeholder:"选择实例",class:"instance-select",onChange:i.handleInstanceChange},{default:k((()=>[(b(!0),x(C,null,D(i.strategyInstanceIds,(e=>(b(),S(n,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])):T("",!0),s.currentInstanceData?(b(),S(F,{key:1,column:4,border:""},{default:k((()=>[v(d,{label:"状态"},{default:k((()=>[t[4]||(t[4]=w("span",{class:"label"},null,-1)),v(c,{type:i.getStateTagType(s.currentInstanceData.state),effect:"light",size:"small"},{default:k((()=>[V(P(s.currentInstanceData.state||"未知"),1)])),_:1},8,["type"])])),_:1}),v(d,{label:"持仓比例"},{default:k((()=>[V(P(i.formatNumber(100*s.currentInstanceData.position_rate,4))+"%",1)])),_:1}),v(d,{label:"正在执行方向"},{default:k((()=>[s.currentInstanceData.current_command?(b(),S(c,{key:0,type:i.getPositionSideTag(s.currentInstanceData.current_command.side),effect:"light",size:"small"},{default:k((()=>[V(P(i.sideZh(s.currentInstanceData.current_command.side)),1)])),_:1},8,["type"])):(b(),x("span",J,"--"))])),_:1}),v(d,{label:"正在执行比例"},{default:k((()=>[s.currentInstanceData.current_command?(b(),S(c,{key:0,type:"info",effect:"light",size:"small"},{default:k((()=>[V(P(100*s.currentInstanceData.current_command.ratio)+"% ",1)])),_:1})):(b(),x("span",W,"--"))])),_:1}),v(d,{label:"持仓",span:4},{default:k((()=>[s.currentInstanceData.position&&s.currentInstanceData.position.length>0?(b(),x("div",X,[v(y,{data:s.currentInstanceData.position,border:"",size:"small",style:{width:"100%"}},{default:k((()=>[v(m,{prop:"quote_currency",label:"计价币种",align:"center"},{default:k((e=>[v(c,{type:"info"},{default:k((()=>[V(P(i.insTypeDesc(e.row.ins_type)),1)])),_:2},1024),V(" "+P(e.row.symbol)+" - "+P(e.row.quote_currency),1)])),_:1}),v(m,{label:"方向/杠杆",align:"center"},{default:k((e=>[v(c,{type:i.getPositionSideTag(e.row.side)},{default:k((()=>[V(P(i.sideZh(e.row.side)),1)])),_:2},1032,["type"]),v(c,{type:e.row.leverage>=1?"info":"danger"},{default:k((()=>[V(P(i.formatNumber(e.row.leverage,2))+"x ",1)])),_:2},1032,["type"])])),_:1}),v(m,{label:"持仓数量(sz)",align:"center"},{default:k((e=>[V(P(i.calcSz(e.row)),1)])),_:1}),v(m,{label:"操作",align:"center"},{default:k((e=>[v(f,{content:"平仓",placement:"top"},{default:k((()=>[v(g,{size:"small",type:"danger",onClick:t=>i.handleClosePosition(e.row),circle:""},{default:k((()=>[v(u,null,{default:k((()=>[v(p)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:1})])),_:1},8,["data"])])):(b(),x("span",Y,"无持仓"))])),_:1}),v(d,{label:"策略状态",span:4},{default:k((()=>[s.currentInstanceData.strategy_state&&Object.keys(s.currentInstanceData.strategy_state).length>0?(b(),x("div",ee,[v(F,{column:1,border:"",size:"small"},{default:k((()=>[(b(!0),x(C,null,D(s.currentInstanceData.strategy_state,((e,a)=>(b(),S(d,{key:a,label:a},{label:k((()=>[w("span",te,P(a),1)])),default:k((()=>[s.editingStrategyStateKey!==a?(b(),x("span",{key:0,class:"state-value editable desc-value-fixed",onClick:t=>i.startEditStrategyState(a,e)},P(e),9,ae)):(b(),x("div",le,["boolean"==typeof s.currentInstanceData.strategy_state[a]?(b(),S(o,{key:0,modelValue:s.editingStrategyStateValue,"onUpdate:modelValue":t[1]||(t[1]=e=>s.editingStrategyStateValue=e),size:"small",onBlur:e=>i.saveStrategyState(a),onChange:e=>i.saveStrategyState(a),teleported:!1},{default:k((()=>[v(n,{label:"true",value:!0}),v(n,{label:"false",value:!1})])),_:2},1032,["modelValue","onBlur","onChange"])):(b(),S(_,{key:1,modelValue:s.editingStrategyStateValue,"onUpdate:modelValue":t[2]||(t[2]=e=>s.editingStrategyStateValue=e),size:"small",onBlur:e=>i.saveStrategyState(a),onKeyup:I((e=>i.saveStrategyState(a)),["enter","native"])},null,8,["modelValue","onBlur","onKeyup"]))]))])),_:2},1032,["label"])))),128))])),_:1})])):(b(),x("span",se,"无状态"))])),_:1})])),_:1})):T("",!0)])):(b(),x("div",Q,[v(r,{description:"暂无数据"})]))])),_:1},8,["modelValue","onClose"])}],["__scopeId","data-v-0f8a79e0"]])},data:()=>({list:null,total:0,listLoading:!0,listQuery:{page:1,size:20,name:void 0},dialogFormVisible:!1,dialogStatus:"",temp:{id:void 0,name:"",description:"",class_name:"",strategy_params:{},data_source_config:null,data_source_params:{},position_config:null,enter_strategy_class_name:"",enter_strategy_config:{},exit_strategy_class_name:"",exit_strategy_config:{},risk_policies:[],selectedDataSourceCls:[],info_fabricator_configs:[],is_enabled:!1},rules:{name:[{required:!0,message:"请输入名称",trigger:"blur"}],selectedDataSourceCls:[{type:"array",required:!0,message:"请选择数据源",trigger:"change"}],position_config:[{required:!0,message:"请选择仓位配置",trigger:"change"}],enter_strategy_class_name:[{required:!0,message:"请选择入场策略",trigger:"change",type:"string"}],exit_strategy_class_name:[{required:!0,message:"请选择出场策略",trigger:"change",type:"string"}]},dataSources:[],dataSourceTemplates:[],positionConfigs:[],currentDataSource:null,enterStrategies:[],exitStrategies:[],riskPolicies:[],positionCollapse:[],strategyOptions:[],enterStrategyOptions:[],exitStrategyOptions:[],enabledExecutors:[],selectedStrategyTemplate:null,strategyParamFormKey:0,selectedEnterStrategyTemplate:null,enterStrategyParamFormKey:0,selectedExitStrategyTemplate:null,exitStrategyParamFormKey:0,rawEnterStrategyTemplates:[],rawExitStrategyTemplates:[],rawStrategyTemplates:[],riskPolicyTemplates:[],selectedRiskPolicyIdx:0,currentDataSourceParameters:[],isEnabledFilter:!0,infoFabricatorCollapse:[],infoFabricatorTemplates:[],selectedInfoFabricatorIdx:0,entryExitCollapse:[],dataDialogVisible:!1,currentStrategyData:null}),computed:{currentRiskPolicyTemplate(){return this.riskPolicyTemplates[this.selectedRiskPolicyIdx]||null},currentRiskPolicyParams:{get(){const e=this.currentRiskPolicyTemplate;if(!e)return{};let t=this.riskPolicies.find((t=>t.name===e.name));return t||(t={name:e.name,enabled:!1,params:{}},this.riskPolicies.push(t)),t.params},set(e){const t=this.currentRiskPolicyTemplate;if(!t)return;let a=this.riskPolicies.find((e=>e.name===t.name));a&&(a.params=e)}},currentDataSourceTemplate(){const e=this.currentDataSource;return e&&this.dataSourceTemplates.find((t=>t.class_name===e.class_name))||null},currentStrategyDesc(){const e=this.strategyOptions.find((e=>e.value===this.temp.class_name));return e&&e.desc?e.desc.replace(/\n/g,"<br/>").replace(/  /g,"&nbsp;&nbsp;"):""},isDataSourceParamDisabled(){return 0===this.temp.selectedDataSourceCls.length},currentInfoFabricatorTemplate(){return this.infoFabricatorTemplates[this.selectedInfoFabricatorIdx]||null},currentInfoFabricatorParams:{get(){const e=this.currentInfoFabricatorTemplate;if(!e)return{};let t=(this.temp.info_fabricator_configs||[]).find((t=>t.class_name===e.cls));return t||(t={class_name:e.cls,enabled:!1,params:{}},this.temp.info_fabricator_configs.push(t)),t.params},set(e){const t=this.currentInfoFabricatorTemplate;if(!t)return;let a=(this.temp.info_fabricator_configs||[]).find((e=>e.class_name===t.cls));a&&(a.params=e)}}},watch:{},created(){this.getList(),this.fetchStrategies(),this.fetchEnterStrategies(),this.fetchExitStrategies(),this.fetchEnabledExecutors(),this.fetchRiskPolicyTemplates(),this.getDataSources(),this.getDataSourceTemplates(),this.fetchInfoFabricatorTemplates(),this.$nextTick((()=>{this.dataSources&&this.dataSources.length>0&&(this.temp.selectedDataSourceCls=this.dataSources.map((e=>e.id)),this.selectDataSource(0))}))},methods:{formatDate:L,formatTag:O,getStrategyName(e){var t;const a=null==(t=this.rawStrategyTemplates)?void 0:t.find((t=>t.cls===e));return a?a.name:e},async getList(){this.listLoading=!0;try{const e={...this.listQuery,is_enabled:this.isEnabledFilter?1:0},{data:t}=await a(e);this.list=t,this.total=t.length}catch(e){this.$message.error("获取策略列表失败")}this.listLoading=!1},async getDataSources(){try{const{data:e}=await g({enable:!0,limit:0});this.dataSources=e}catch(e){this.$message.error("获取数据源列表失败")}},async getEnterStrategies(){try{const{data:e}=await l();this.enterStrategies=e}catch(e){this.$message.error("获取入场策略列表失败")}},async getExitStrategies(){try{const{data:e}=await s();this.exitStrategies=e}catch(e){this.$message.error("获取出场策略列表失败")}},async getRiskPolicies(){try{const{data:e}=await _.get("/api/risk-policies");this.riskPolicies=e}catch(e){this.$message.error("获取风险控制策略列表失败")}},handleFilter(){this.listQuery.page=1,this.getList()},resetTemp(){this.temp={id:void 0,name:"",description:"",class_name:"",strategy_params:{},data_source_config:null,data_source_params:{},position_config:null,enter_strategy_class_name:"",enter_strategy_config:{},exit_strategy_class_name:"",exit_strategy_config:{},risk_policies:[],selectedDataSourceCls:[],info_fabricator_configs:[],is_enabled:!1},this.currentDataSource=null,this.currentDataSourceParameters=[],this.positionCollapse=[],this.infoFabricatorCollapse=[]},handleCreate(){this.resetTemp(),this.collapsePositionConfig(),this.dialogStatus="create",this.dialogFormVisible=!0,this.fetchStrategies();const e=this.enterStrategyOptions.find((e=>"leek_core.sub_strategy.base|EnterStrategy"===e.value));e&&(this.temp.enter_strategy_class_name=e.value||"",this.handleEnterStrategyTemplateChange(e.value));const t=this.exitStrategyOptions.find((e=>"leek_core.sub_strategy.base|ExitStrategy"===e.value));t&&(this.temp.exit_strategy_class_name=t.value||"",this.handleExitStrategyTemplateChange(t.value)),this.$nextTick((()=>{this.$refs.dataForm.clearValidate()}))},async createData(){this.$refs.dataForm.validate((async e=>{if(e)try{const e={...this.temp};e.params=this.temp.strategy_params||{},e.position_config&&0!==Object.keys(e.position_config).length||delete e.position_config,e.sparams=this.temp.strategy_params||{},e.data_source_config=(this.temp.selectedDataSourceCls||[]).map((e=>{const t=this.dataSources.find((t=>t.id===e));return{id:t.id,class_name:t.class_name,config:this.temp.data_source_params&&this.temp.data_source_params[t.id]||{}}})),e.risk_policies=(this.riskPolicyTemplates||[]).filter(((e,t)=>this.isRiskPolicyEnabled(e.name))).map((e=>{var t;return{class_name:e.cls,config:(null==(t=this.riskPolicies.find((t=>t.name===e.name)))?void 0:t.params)||{}}})),e.info_fabricator_configs=(this.infoFabricatorTemplates||[]).filter(((e,t)=>this.isInfoFabricatorEnabled(e.cls))).map((e=>{var t;return{class_name:e.cls,config:(null==(t=(this.temp.info_fabricator_configs||[]).find((t=>t.class_name===e.cls)))?void 0:t.params)||{}}})),e.data_source_params=void 0,e.is_enabled=this.temp.is_enabled,await i(e),this.isEnabledFilter=this.temp.is_enabled,this.dialogFormVisible=!1,this.$message.success("创建成功"),this.getList()}catch(t){this.$message.error("创建失败")}}))},handleUpdate(e){this.collapsePositionConfig(),this.fetchStrategies(),this.temp={id:e.id,name:e.name||"",description:e.description||"",class_name:e.class_name||"",strategy_params:e.params||{},selectedDataSourceCls:e.data_source_config.map((e=>e.id)),position_config:e.position_config||null,enter_strategy_class_name:e.enter_strategy_class_name,enter_strategy_config:e.enter_strategy_config||{},exit_strategy_class_name:e.exit_strategy_class_name,exit_strategy_config:e.exit_strategy_config||{},risk_policies:[],info_fabricator_configs:Array.isArray(e.info_fabricator_configs)?e.info_fabricator_configs.map((e=>({class_name:e.class_name,enabled:!0,params:e.config||{}}))):[],is_enabled:e.is_enabled||!1},e.class_name&&this.handleStrategyTemplateChange(e.class_name),Array.isArray(e.data_source_config)&&(this.temp.data_source_params={},e.data_source_config.forEach((e=>{this.temp.data_source_params[e.id]=e.config||{}}))),Array.isArray(e.risk_policies)&&(this.riskPolicies=(this.riskPolicyTemplates||[]).map((t=>{const a=e.risk_policies.find((e=>e.class_name===t.cls));return{name:t.name,enabled:!!a,params:a&&a.config||{}}}))),this.dialogStatus="update",this.dialogFormVisible=!0,this.$nextTick((()=>{this.fetchEnterStrategies(),this.fetchExitStrategies(),this.$refs.dataForm.clearValidate()}))},async updateData(){this.collapsePositionConfig(),this.$refs.dataForm.validate((async e=>{if(e)try{const e={...this.temp};e.params=this.temp.strategy_params||{},e.position_config&&0!==Object.keys(e.position_config).length||delete e.position_config,e.strategy_params=this.temp.strategy_params||{},e.data_source_config=(this.temp.selectedDataSourceCls||[]).map((e=>{const t=this.dataSources.find((t=>t.id===e));return{id:t.id,class_name:t.class_name,config:this.temp.data_source_params&&this.temp.data_source_params[t.id]||{}}})),e.risk_policies=(this.riskPolicyTemplates||[]).filter(((e,t)=>this.isRiskPolicyEnabled(e.name))).map((e=>{var t;return{class_name:e.cls,config:(null==(t=this.riskPolicies.find((t=>t.name===e.name)))?void 0:t.params)||{}}})),e.info_fabricator_configs=(this.infoFabricatorTemplates||[]).filter(((e,t)=>this.isInfoFabricatorEnabled(e.cls))).map((e=>{var t;return{class_name:e.cls,config:(null==(t=(this.temp.info_fabricator_configs||[]).find((t=>t.class_name===e.cls)))?void 0:t.params)||{}}})),e.data_source_params=void 0,e.is_enabled=this.temp.is_enabled,await r(this.temp.id,e),this.dialogFormVisible=!1,this.$message.success("更新成功"),this.getList()}catch(t){this.$message.error("更新失败")}}))},async handleDelete(e){try{await this.$confirm("确认删除该策略?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await n(e.id),this.$message.success("删除成功"),this.getList()}catch(t){"cancel"!==t&&this.$message.error("删除失败")}},async handleRun(e){try{await this.$confirm("确认运行该策略?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await o(e.id),this.$message.success("策略已启动")}catch(t){"cancel"!==t&&this.$message.error("启动失败")}},async fetchStrategies(){const e=await c();this.rawStrategyTemplates=e.data,this.strategyOptions=e.data.map((e=>({label:e.name,value:e.cls,tag:e.tag,desc:e.desc})))},async fetchEnterStrategies(){const e=await d();this.rawEnterStrategyTemplates=e.data,this.enterStrategyOptions=e.data.map((e=>({label:e.name,value:e.cls,tag:e.tag})));const t=this.enterStrategyOptions.find((e=>"leek_core.sub_strategy.base|EnterStrategy"===e.value));t&&!this.temp.enter_strategy_class_name&&(this.temp.enter_strategy_class_name=t.value,this.handleEnterStrategyTemplateChange(t.value))},async fetchExitStrategies(){const e=await m();this.rawExitStrategyTemplates=e.data,this.exitStrategyOptions=e.data.map((e=>({label:e.name,value:e.cls,tag:e.tag})));const t=this.exitStrategyOptions.find((e=>"leek_core.sub_strategy.base|ExitStrategy"===e.value));t&&!this.temp.exit_strategy_class_name&&(this.temp.exit_strategy_class_name=t.value,this.handleExitStrategyTemplateChange(t.value))},async fetchEnabledExecutors(){try{const{data:e}=await q({enable:!0,limit:0});this.enabledExecutors=e.map((e=>({id:e.id,name:e.name})))}catch(e){this.$message.error("获取执行器列表失败")}},togglePositionCollapse(){this.positionCollapse.includes("position")?this.positionCollapse=[]:(this.positionCollapse=["position"],this.temp.position_config||(this.temp.position_config={principal:20,leverage:1,order_type:1,executor_id:null}))},toggleInfoFabricatorCollapse(){this.infoFabricatorCollapse.includes("info_fabricator")?this.infoFabricatorCollapse=[]:(this.infoFabricatorCollapse=["info_fabricator"],Array.isArray(this.temp.info_fabricator_configs)||(this.temp.info_fabricator_configs=[]))},collapsePositionConfig(){this.positionCollapse=[]},handleStrategyTemplateChange(e){this.selectedStrategyTemplate=this.rawStrategyTemplates.find((t=>t.cls===e)),this.strategyParamFormKey++},handleEnterStrategyTemplateChange(e){"string"!=typeof e&&(e=""),this.selectedEnterStrategyTemplate=this.rawEnterStrategyTemplates.find((t=>t.cls===e)),this.enterStrategyParamFormKey++},handleExitStrategyTemplateChange(e){"string"!=typeof e&&(e=""),this.selectedExitStrategyTemplate=this.rawExitStrategyTemplates.find((t=>t.cls===e)),this.exitStrategyParamFormKey++},async fetchRiskPolicyTemplates(){const{data:e}=await p();this.riskPolicyTemplates=e},selectRiskPolicy(e){this.selectedRiskPolicyIdx=e},isRiskPolicyEnabled(e){const t=this.riskPolicies.find((t=>t.name===e));return!!t&&t.enabled},setRiskPolicyEnabled(e,t){let a=this.riskPolicies.find((t=>t.name===e));a?a.enabled=t:this.riskPolicies.push({name:e,enabled:t,params:{}})},selectDataSource(e){const t=this.dataSources[e];t!=this.currentDataSource&&(this.currentDataSource=t,t&&(this.temp.data_source_config={id:t.id,name:t.name,params:this.temp.data_source_params&&this.temp.data_source_params[t.id]?this.temp.data_source_params[t.id]:{}},this.fetchDataSourceParameters(t)))},async getDataSourceTemplates(){try{const{data:e}=await f();this.dataSourceTemplates=e}catch(e){this.$message.error("获取数据源模板失败")}},async fetchDataSourceParameters(e){if(e)try{const{data:t}=await y({class_name:e.class_name,params:e.params||{}});this.currentDataSourceParameters=t}catch(t){this.currentDataSourceParameters=[]}else this.currentDataSourceParameters=[]},formatDesc:e=>e?e.replace(/\n/g,"<br/>").replace(/  /g,"&nbsp;&nbsp;"):"",async handleDisable(e){await r(e.id,{is_enabled:!1}),this.getList()},async handleEnable(e){await r(e.id,{is_enabled:!0}),this.getList()},getDataSourceName(e){const t=this.dataSources.find((t=>t.id===e.id));return t?t.name:e.class_name||"未知数据源"},async fetchInfoFabricatorTemplates(){try{const{data:e}=await u();this.infoFabricatorTemplates=e}catch(e){this.$message.error("获取数据处理模板失败")}},selectInfoFabricator(e){this.selectedInfoFabricatorIdx=e},getInfoFabricatorName(e){const t=this.infoFabricatorTemplates.find((t=>t.name===e.name));return t?t.name:e.class_name||"未知处理器"},toggleEntryExitCollapse(){this.entryExitCollapse.includes("entry_exit")?this.entryExitCollapse=[]:this.entryExitCollapse=["entry_exit"]},isInfoFabricatorEnabled(e){const t=(this.temp.info_fabricator_configs||[]).find((t=>t.class_name===e));return!!t&&t.enabled},setInfoFabricatorEnabled(e,t){let a=(this.temp.info_fabricator_configs||[]).find((t=>t.class_name===e));a?a.enabled=t:this.temp.info_fabricator_configs.push({class_name:e,enabled:t,params:{}})},async handleViewData(e){this.currentStrategyData=e,this.dataDialogVisible=!0},async handleClearRuntimeData(e){try{await this.$confirm("确认清除该策略的运行时数据?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await t(e.id,{}),this.$message.success("运行时数据已清除"),this.getList()}catch(a){"cancel"!==a&&this.$message.error("清除运行时数据失败")}}}},[["render",function(e,t,a,l,s,i){const r=h("el-switch"),n=h("el-input"),o=h("Plus"),c=h("el-icon"),d=h("el-button"),m=h("el-skeleton"),p=h("el-table-column"),u=h("el-tag"),g=h("Edit"),f=h("el-tooltip"),y=h("DataAnalysis"),_=h("Discount"),R=h("VideoPlay"),$=h("RemoveFilled"),L=h("Odometer"),O=h("Delete"),A=h("el-table"),j=h("pagination"),K=h("el-card"),B=h("el-form-item"),M=h("el-option"),q=h("el-select"),H=h("DynamicForm"),N=h("el-checkbox"),Q=h("el-checkbox-group"),Z=h("el-col"),G=h("el-row"),J=h("el-link"),W=h("el-input-number"),X=h("el-form"),Y=h("el-dialog"),ee=h("StrategyDataViewer");return b(),x("div",ie,[v(K,{shadow:"hover"},{header:k((()=>[w("div",re,[w("div",ne,[w("div",oe,[w("div",ce,[v(r,{modelValue:s.isEnabledFilter,"onUpdate:modelValue":t[0]||(t[0]=e=>s.isEnabledFilter=e),"active-text":"启用","inactive-text":"未启用",onChange:i.handleFilter},null,8,["modelValue","onChange"]),v(n,{modelValue:s.listQuery.name,"onUpdate:modelValue":t[1]||(t[1]=e=>s.listQuery.name=e),placeholder:"策略名称",style:{width:"200px"},class:"filter-item",onKeyup:I(i.handleFilter,["enter"])},null,8,["modelValue","onKeyup"])])]),w("div",de,[v(d,{type:"primary",onClick:i.handleCreate},{default:k((()=>[v(c,null,{default:k((()=>[v(o)])),_:1}),t[28]||(t[28]=V(" 添加策略 "))])),_:1},8,["onClick"])])])])])),default:k((()=>[s.listLoading?(b(),x("div",me,[v(m,{rows:4,animated:""})])):(b(),x("div",pe,[v(A,{data:s.list||[],style:{width:"100%"},size:"small",border:"",fit:"","highlight-current-row":""},{default:k((()=>[v(p,{align:"center",label:"ID",width:"95"},{default:k((e=>[V(P(e.row.id),1)])),_:1}),v(p,{label:"名称"},{default:k((e=>[V(P(e.row.name),1)])),_:1}),v(p,{label:"策略名"},{default:k((e=>[V(P(i.getStrategyName(e.row.class_name)),1)])),_:1}),v(p,{label:"数据源配置"},{default:k((({row:e})=>[Array.isArray(e.data_source_config)&&e.data_source_config.length?(b(!0),x(C,{key:0},D(e.data_source_config,(e=>(b(),S(u,{key:e.id||e.class_name,size:"small",type:"info",effect:"plain",style:{"margin-right":"4px"}},{default:k((()=>[V(P(i.getDataSourceName(e)),1)])),_:2},1024)))),128)):(b(),S(u,{key:1,size:"small",type:"info",effect:"plain"},{default:k((()=>t[29]||(t[29]=[V("未配置")]))),_:1}))])),_:1}),v(p,{label:"创建时间",width:"180"},{default:k((e=>[V(P(i.formatDate(e.row.created_at)),1)])),_:1}),v(p,{label:"操作",align:"center",width:"320"},{default:k((e=>[v(f,{content:"编辑",placement:"top"},{default:k((()=>[v(d,{size:"small",onClick:t=>i.handleUpdate(e.row),circle:""},{default:k((()=>[v(c,null,{default:k((()=>[v(g)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024),e.row.is_enabled?(b(),S(f,{key:0,content:"查看数据",placement:"top"},{default:k((()=>[v(d,{size:"small",type:"primary",onClick:t=>i.handleViewData(e.row),circle:""},{default:k((()=>[v(c,null,{default:k((()=>[v(y)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)):T("",!0),e.row.is_enabled?(b(),S(f,{key:1,content:"清除运行时数据",placement:"top"},{default:k((()=>[v(d,{size:"small",type:"info",onClick:t=>i.handleClearRuntimeData(e.row),circle:""},{default:k((()=>[v(c,null,{default:k((()=>[v(_)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)):T("",!0),e.row.is_enabled?T("",!0):(b(),S(f,{key:2,content:"启用",placement:"top"},{default:k((()=>[v(d,{size:"small",type:"primary",onClick:t=>i.handleEnable(e.row),circle:""},{default:k((()=>[v(c,null,{default:k((()=>[v(R)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)),e.row.is_enabled?(b(),S(f,{key:3,content:"禁用",placement:"top"},{default:k((()=>[v(d,{size:"small",type:"warning",onClick:t=>i.handleDisable(e.row),circle:""},{default:k((()=>[v(c,null,{default:k((()=>[v($)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)):T("",!0),v(f,{content:"回测",placement:"top"},{default:k((()=>[v(d,{size:"small",type:"success",onClick:t=>i.handleRun(e.row),circle:""},{default:k((()=>[v(c,null,{default:k((()=>[v(L)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024),e.row.is_enabled?T("",!0):(b(),S(f,{key:4,content:"删除",placement:"top"},{default:k((()=>[v(d,{size:"small",type:"danger",onClick:t=>i.handleDelete(e.row),circle:""},{default:k((()=>[v(c,null,{default:k((()=>[v(O)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024))])),_:1})])),_:1},8,["data"])])),F(v(j,{total:s.total,page:s.listQuery.page,"onUpdate:page":t[2]||(t[2]=e=>s.listQuery.page=e),limit:s.listQuery.size,"onUpdate:limit":t[3]||(t[3]=e=>s.listQuery.size=e),onPagination:i.getList},null,8,["total","page","limit","onPagination"]),[[E,s.total>0]])])),_:1}),v(Y,{title:"create"===s.dialogStatus?"创建策略":"编辑策略",modelValue:s.dialogFormVisible,"onUpdate:modelValue":t[26]||(t[26]=e=>s.dialogFormVisible=e),width:"900px"},{footer:k((()=>[w("div",He,[v(d,{onClick:t[24]||(t[24]=e=>s.dialogFormVisible=!1)},{default:k((()=>t[34]||(t[34]=[V("取消")]))),_:1}),v(d,{type:"primary",onClick:t[25]||(t[25]=e=>"create"===s.dialogStatus?i.createData():i.updateData())},{default:k((()=>t[35]||(t[35]=[V(" 确认 ")]))),_:1})])])),default:k((()=>[v(X,{ref:"dataForm",rules:s.rules,model:s.temp,"label-position":"right","label-width":"120px"},{default:k((()=>[v(B,{label:"名称",prop:"name"},{default:k((()=>[v(n,{modelValue:s.temp.name,"onUpdate:modelValue":t[4]||(t[4]=e=>s.temp.name=e),onFocus:i.collapsePositionConfig},null,8,["modelValue","onFocus"])])),_:1}),v(B,{label:"描述"},{default:k((()=>[v(n,{modelValue:s.temp.description,"onUpdate:modelValue":t[5]||(t[5]=e=>s.temp.description=e),onFocus:i.collapsePositionConfig},null,8,["modelValue","onFocus"])])),_:1}),v(B,{label:"策略",prop:"class_name",required:""},{default:k((()=>[i.currentStrategyDesc?(b(),S(f,{key:0,placement:"top",effect:"light"},{content:k((()=>[w("div",{innerHTML:i.currentStrategyDesc,style:{"white-space":"pre-line","max-width":"400px"}},null,8,ue)])),default:k((()=>[v(q,{modelValue:s.temp.class_name,"onUpdate:modelValue":t[6]||(t[6]=e=>s.temp.class_name=e),onFocus:i.collapsePositionConfig,filterable:"",clearable:"",onChange:i.handleStrategyTemplateChange},{default:k((()=>[(b(!0),x(C,null,D(s.strategyOptions,(e=>(b(),S(M,{key:e.value,label:e.label,value:e.value},{default:k((()=>[e.desc?(b(),S(f,{key:0,effect:"light",placement:"right","hide-after":0},{content:k((()=>[w("div",{innerHTML:i.formatDesc(e.desc),style:{"white-space":"pre-line","max-width":"400px"}},null,8,ge)])),default:k((()=>[w("span",null,[V(P(e.label)+" ",1),e.tag?(b(),S(u,{key:0,size:"small",type:"info",effect:"plain",style:{"margin-left":"6px","font-size":"12px",color:"#b0b3b8","border-color":"#e0e0e0"}},{default:k((()=>[V(P(i.formatTag(e.tag)),1)])),_:2},1024)):T("",!0)])])),_:2},1024)):(b(),x("span",fe,[V(P(e.label)+" ",1),e.tag?(b(),S(u,{key:0,size:"small",type:"info",effect:"plain",style:{"margin-left":"6px","font-size":"12px",color:"#b0b3b8","border-color":"#e0e0e0"}},{default:k((()=>[V(P(i.formatTag(e.tag)),1)])),_:2},1024)):T("",!0)]))])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue","onFocus","onChange"])])),_:1})):(b(),S(q,{key:1,modelValue:s.temp.class_name,"onUpdate:modelValue":t[7]||(t[7]=e=>s.temp.class_name=e),onFocus:i.collapsePositionConfig,filterable:"",clearable:"",onChange:i.handleStrategyTemplateChange},{default:k((()=>[(b(!0),x(C,null,D(s.strategyOptions,(e=>(b(),S(M,{key:e.value,label:e.label,value:e.value},{default:k((()=>[e.desc?(b(),S(f,{key:0,effect:"light",placement:"right","hide-after":0},{content:k((()=>[w("div",{innerHTML:i.formatDesc(e.desc),style:{"white-space":"pre-line","max-width":"400px"}},null,8,ye)])),default:k((()=>[w("span",null,[V(P(e.label)+" ",1),e.tag?(b(),S(u,{key:0,size:"small",type:"info",effect:"plain",style:{"margin-left":"6px","font-size":"12px",color:"#b0b3b8","border-color":"#e0e0e0"}},{default:k((()=>[V(P(i.formatTag(e.tag)),1)])),_:2},1024)):T("",!0)])])),_:2},1024)):(b(),x("span",_e,[V(P(e.label)+" ",1),e.tag?(b(),S(u,{key:0,size:"small",type:"info",effect:"plain",style:{"margin-left":"6px","font-size":"12px",color:"#b0b3b8","border-color":"#e0e0e0"}},{default:k((()=>[V(P(i.formatTag(e.tag)),1)])),_:2},1024)):T("",!0)]))])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue","onFocus","onChange"]))])),_:1}),v(B,{label:"策略参数",prop:"strategy_params"},{default:k((()=>[w("div",he,[s.selectedStrategyTemplate&&Array.isArray(s.selectedStrategyTemplate.parameters)&&s.selectedStrategyTemplate.parameters.length>0&&s.temp.class_name?(b(),S(H,{fields:s.selectedStrategyTemplate.parameters,modelValue:s.temp.strategy_params,"onUpdate:modelValue":t[8]||(t[8]=e=>s.temp.strategy_params=e),key:s.strategyParamFormKey},null,8,["fields","modelValue"])):(b(),x("div",be,"无需参数"))])])),_:1}),v(B,{label:"数据源",prop:"selectedDataSourceCls"},{default:k((()=>[v(G,{gutter:24,style:{width:"100%"}},{default:k((()=>[v(Z,{span:7,style:{"min-width":"200px"}},{default:k((()=>[w("div",Se,[v(Q,{modelValue:s.temp.selectedDataSourceCls,"onUpdate:modelValue":t[9]||(t[9]=e=>s.temp.selectedDataSourceCls=e)},{default:k((()=>[(b(!0),x(C,null,D(s.dataSources,((e,a)=>(b(),x("div",{key:e.id,onClick:e=>i.selectDataSource(a),style:{display:"flex","align-items":"center","justify-content":"space-between","margin-bottom":"8px"}},[w("span",xe,P(e.name),1),v(N,{value:e.id},{default:k((()=>t[30]||(t[30]=[w("span",{style:{display:"none"}},null,-1)]))),_:2},1032,["value"])],8,ke)))),128)),s.dataSources.length?T("",!0):(b(),x("div",ve,"暂无数据源"))])),_:1},8,["modelValue"])])])),_:1}),v(Z,{span:1,class:"vertical-divider-col"},{default:k((()=>t[31]||(t[31]=[w("div",{class:"vertical-divider"},null,-1)]))),_:1}),v(Z,{span:15},{default:k((()=>[s.currentDataSource?(b(),x("div",{key:0,class:z(["param-scroll-area",{"param-disabled":i.isDataSourceParamDisabled}]),style:{padding:"24px",background:"#fff","border-radius":"8px","min-height":"100px"}},[Array.isArray(s.currentDataSourceParameters)&&s.currentDataSourceParameters.length>0?(b(),S(H,{fields:s.currentDataSourceParameters,modelValue:s.temp.data_source_params[s.currentDataSource.id],"onUpdate:modelValue":t[10]||(t[10]=e=>s.temp.data_source_params[s.currentDataSource.id]=e),key:s.currentDataSource.id,disabled:i.isDataSourceParamDisabled},null,8,["fields","modelValue","disabled"])):(b(),x("div",Ce,"无需参数"))],2)):(b(),x("div",De,"请选择左侧数据源"))])),_:1})])),_:1})])),_:1}),v(B,{label:"数据处理配置"},{default:k((()=>[v(J,{type:"primary",onClick:i.toggleInfoFabricatorCollapse,style:{"margin-left":"8px"}},{default:k((()=>[V(P(s.infoFabricatorCollapse.includes("info_fabricator")?"收起数据处理配置":s.temp.info_fabricator_configs?"展开数据处理配置":"数据处理配置"),1)])),_:1},8,["onClick"])])),_:1}),s.infoFabricatorCollapse.includes("info_fabricator")?(b(),x(C,{key:0},[s.temp.info_fabricator_configs?(b(),x("div",Te,[v(G,{gutter:24,style:{width:"100%"}},{default:k((()=>[v(Z,{span:7,style:{"min-width":"200px"}},{default:k((()=>[w("div",we,[(b(!0),x(C,null,D(s.infoFabricatorTemplates,((e,a)=>(b(),x("div",{key:e.name,onClick:e=>i.selectInfoFabricator(a),class:z({active:a===s.selectedInfoFabricatorIdx}),style:{display:"flex","align-items":"center","justify-content":"space-between",cursor:"pointer","margin-bottom":"8px"}},[e.desc?(b(),S(f,{key:0,effect:"light",placement:"left","hide-after":0},{content:k((()=>[w("div",{innerHTML:i.formatDesc(e.desc),style:{"white-space":"pre-line","max-width":"400px"}},null,8,Pe)])),default:k((()=>[w("span",null,[V(P(e.name)+" ",1),e.tag?(b(),S(u,{key:0,size:"small",type:"info",effect:"plain",style:{"margin-left":"6px","font-size":"12px",color:"#b0b3b8","border-color":"#e0e0e0"}},{default:k((()=>[V(P(i.formatTag(e.tag)),1)])),_:2},1024)):T("",!0)])])),_:2},1024)):(b(),x("span",Ie,[V(P(e.name)+" ",1),e.tag?(b(),S(u,{key:0,size:"small",type:"info",effect:"plain",style:{"margin-left":"6px","font-size":"12px",color:"#b0b3b8","border-color":"#e0e0e0"}},{default:k((()=>[V(P(i.formatTag(e.tag)),1)])),_:2},1024)):T("",!0)])),v(r,{"model-value":i.isInfoFabricatorEnabled(e.cls),"onUpdate:modelValue":t=>i.setInfoFabricatorEnabled(e.cls,t),onClick:t[11]||(t[11]=U((()=>{}),["stop"]))},null,8,["model-value","onUpdate:modelValue"])],10,Ve)))),128)),s.infoFabricatorTemplates.length?T("",!0):(b(),x("div",Fe,"暂无处理器"))])])),_:1}),v(Z,{span:1,class:"vertical-divider-col"},{default:k((()=>t[32]||(t[32]=[w("div",{class:"vertical-divider"},null,-1)]))),_:1}),v(Z,{span:15},{default:k((()=>[i.currentInfoFabricatorTemplate?(b(),x("div",{key:0,class:z({"param-disabled":!i.isInfoFabricatorEnabled(i.currentInfoFabricatorTemplate.cls)}),style:{padding:"24px",background:"#fff","border-radius":"8px","min-height":"180px"}},[Array.isArray(i.currentInfoFabricatorTemplate.parameters)&&i.currentInfoFabricatorTemplate.parameters.length>0?(b(),S(H,{fields:i.currentInfoFabricatorTemplate.parameters||[],modelValue:i.currentInfoFabricatorParams,"onUpdate:modelValue":t[12]||(t[12]=e=>i.currentInfoFabricatorParams=e),key:i.currentInfoFabricatorTemplate.name,disabled:!i.isInfoFabricatorEnabled(i.currentInfoFabricatorTemplate.cls)},null,8,["fields","modelValue","disabled"])):(b(),x("div",Ee,"无需参数"))],2)):(b(),x("div",ze,"请选择左侧处理器"))])),_:1})])),_:1})])):T("",!0)],64)):T("",!0),v(B,{label:"仓位配置"},{default:k((()=>[v(J,{type:"primary",onClick:i.togglePositionCollapse,style:{"margin-left":"8px"}},{default:k((()=>[V(P(s.positionCollapse.includes("position")?"收起仓位设置":s.temp.position_config?"展开仓位设置":"仓位设置"),1)])),_:1},8,["onClick"])])),_:1}),s.positionCollapse.includes("position")?(b(),x(C,{key:1},[s.temp.position_config?(b(),x("div",Ue,[v(B,{label:"单组资金"},{default:k((()=>[v(W,{modelValue:s.temp.position_config.principal,"onUpdate:modelValue":t[13]||(t[13]=e=>s.temp.position_config.principal=e),min:0},null,8,["modelValue"])])),_:1}),v(B,{label:"杠杆"},{default:k((()=>[v(W,{modelValue:s.temp.position_config.leverage,"onUpdate:modelValue":t[14]||(t[14]=e=>s.temp.position_config.leverage=e),min:1},null,8,["modelValue"])])),_:1}),v(B,{label:"限制下单类型"},{default:k((()=>[v(q,{modelValue:s.temp.position_config.order_type,"onUpdate:modelValue":t[15]||(t[15]=e=>s.temp.position_config.order_type=e),modelModifiers:{number:!0},style:{width:"200px"}},{default:k((()=>[v(M,{label:"市价单",value:1}),v(M,{label:"限价单",value:2})])),_:1},8,["modelValue"])])),_:1}),v(B,{label:"指定执行器"},{default:k((()=>[v(q,{modelValue:s.temp.position_config.executor_id,"onUpdate:modelValue":t[16]||(t[16]=e=>s.temp.position_config.executor_id=e),style:{width:"200px"},clearable:"",placeholder:"不指定"},{default:k((()=>[(b(!0),x(C,null,D(s.enabledExecutors,(e=>(b(),S(M,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])):T("",!0)],64)):T("",!0),v(B,{label:"出入场配置"},{default:k((()=>[v(J,{type:"primary",onClick:i.toggleEntryExitCollapse,style:{"margin-left":"8px"}},{default:k((()=>[V(P(s.entryExitCollapse.includes("entry_exit")?"收起出入场配置":"展开出入场配置"),1)])),_:1},8,["onClick"])])),_:1}),s.entryExitCollapse.includes("entry_exit")?(b(),x(C,{key:2},[v(B,{label:"入场策略",prop:"enter_strategy_class_name"},{default:k((()=>[v(q,{modelValue:s.temp.enter_strategy_class_name,"onUpdate:modelValue":t[17]||(t[17]=e=>s.temp.enter_strategy_class_name=e),onFocus:i.collapsePositionConfig,filterable:"",clearable:"",onChange:i.handleEnterStrategyTemplateChange},{default:k((()=>[(b(!0),x(C,null,D(s.enterStrategyOptions,(e=>(b(),S(M,{key:e.value,label:e.label,value:e.value},{default:k((()=>[w("span",null,P(e.label),1),e.tag?(b(),S(u,{key:0,size:"small",type:"info",effect:"plain",style:{"margin-left":"6px","font-size":"12px",color:"#b0b3b8","border-color":"#e0e0e0"}},{default:k((()=>[V(P(e.tag),1)])),_:2},1024)):T("",!0)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue","onFocus","onChange"])])),_:1}),v(B,{label:"入场参数",prop:"enter_strategy_config"},{default:k((()=>[w("div",Re,[s.selectedEnterStrategyTemplate&&Array.isArray(s.selectedEnterStrategyTemplate.parameters)&&s.selectedEnterStrategyTemplate.parameters.length>0&&s.temp.enter_strategy_class_name?(b(),S(H,{fields:s.selectedEnterStrategyTemplate.parameters,modelValue:s.temp.enter_strategy_config,"onUpdate:modelValue":t[18]||(t[18]=e=>s.temp.enter_strategy_config=e),key:s.enterStrategyParamFormKey},null,8,["fields","modelValue"])):(b(),x("div",$e,"无需参数"))])])),_:1}),v(B,{label:"出场策略",prop:"exit_strategy_class_name"},{default:k((()=>[v(q,{modelValue:s.temp.exit_strategy_class_name,"onUpdate:modelValue":t[19]||(t[19]=e=>s.temp.exit_strategy_class_name=e),onFocus:i.collapsePositionConfig,filterable:"",clearable:"",onChange:i.handleExitStrategyTemplateChange},{default:k((()=>[(b(!0),x(C,null,D(s.exitStrategyOptions,(e=>(b(),S(M,{key:e.value,label:e.label,value:e.value},{default:k((()=>[w("span",null,P(e.label),1),e.tag?(b(),S(u,{key:0,size:"small",type:"info",effect:"plain",style:{"margin-left":"6px","font-size":"12px",color:"#b0b3b8","border-color":"#e0e0e0"}},{default:k((()=>[V(P(e.tag),1)])),_:2},1024)):T("",!0)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue","onFocus","onChange"])])),_:1}),v(B,{label:"出场参数",prop:"exit_strategy_config"},{default:k((()=>[w("div",Le,[s.selectedExitStrategyTemplate&&Array.isArray(s.selectedExitStrategyTemplate.parameters)&&s.selectedExitStrategyTemplate.parameters.length>0&&s.temp.exit_strategy_class_name?(b(),S(H,{fields:s.selectedExitStrategyTemplate.parameters,modelValue:s.temp.exit_strategy_config,"onUpdate:modelValue":t[20]||(t[20]=e=>s.temp.exit_strategy_config=e),key:s.exitStrategyParamFormKey},null,8,["fields","modelValue"])):(b(),x("div",Oe,"无需参数"))])])),_:1})],64)):T("",!0),v(B,{label:"风控",prop:"risk_policies"},{default:k((()=>[v(G,{gutter:24,style:{width:"100%"}},{default:k((()=>[v(Z,{span:7,style:{"min-width":"200px"}},{default:k((()=>[w("div",Ae,[(b(!0),x(C,null,D(s.riskPolicyTemplates,((e,a)=>(b(),x("div",{key:e.name,onClick:e=>i.selectRiskPolicy(a),class:z({active:a===s.selectedRiskPolicyIdx}),style:{display:"flex","align-items":"center","justify-content":"space-between",cursor:"pointer","margin-bottom":"8px"}},[e.desc?(b(),S(f,{key:0,effect:"light",placement:"left","hide-after":0},{content:k((()=>[w("div",{innerHTML:i.formatDesc(e.desc),style:{"white-space":"pre-line","max-width":"400px"}},null,8,Ke)])),default:k((()=>[w("span",null,[V(P(e.name)+" ",1),e.tag?(b(),S(u,{key:0,size:"small",type:"info",effect:"plain",style:{"margin-left":"6px","font-size":"12px",color:"#b0b3b8","border-color":"#e0e0e0"}},{default:k((()=>[V(P(i.formatTag(e.tag)),1)])),_:2},1024)):T("",!0)])])),_:2},1024)):(b(),x("span",Be,[V(P(e.name)+" ",1),e.tag?(b(),S(u,{key:0,size:"small",type:"info",effect:"plain",style:{"margin-left":"6px","font-size":"12px",color:"#b0b3b8","border-color":"#e0e0e0"}},{default:k((()=>[V(P(i.formatTag(e.tag)),1)])),_:2},1024)):T("",!0)])),v(r,{"model-value":i.isRiskPolicyEnabled(e.name),"onUpdate:modelValue":t=>i.setRiskPolicyEnabled(e.name,t),onClick:t[21]||(t[21]=U((()=>{}),["stop"]))},null,8,["model-value","onUpdate:modelValue"])],10,je)))),128)),s.riskPolicyTemplates.length?T("",!0):(b(),x("div",Me,"暂无策略"))])])),_:1}),v(Z,{span:1,class:"vertical-divider-col"},{default:k((()=>t[33]||(t[33]=[w("div",{class:"vertical-divider"},null,-1)]))),_:1}),v(Z,{span:15},{default:k((()=>[i.currentRiskPolicyTemplate?(b(),x("div",{key:0,class:z({"param-disabled":!i.isRiskPolicyEnabled(i.currentRiskPolicyTemplate.name)}),style:{padding:"24px",background:"#fff","border-radius":"8px","min-height":"180px"}},[(b(),S(H,{fields:i.currentRiskPolicyTemplate.parameters||[],modelValue:i.currentRiskPolicyParams,"onUpdate:modelValue":t[22]||(t[22]=e=>i.currentRiskPolicyParams=e),key:i.currentRiskPolicyTemplate.name,disabled:!i.isRiskPolicyEnabled(i.currentRiskPolicyTemplate.name)},null,8,["fields","modelValue","disabled"]))],2)):(b(),x("div",qe,"请选择左侧策略"))])),_:1})])),_:1})])),_:1}),"create"===s.dialogStatus?(b(),S(B,{key:3,label:"是否启用",prop:"is_enabled"},{default:k((()=>[v(r,{modelValue:s.temp.is_enabled,"onUpdate:modelValue":t[23]||(t[23]=e=>s.temp.is_enabled=e)},null,8,["modelValue"])])),_:1})):T("",!0)])),_:1},8,["rules","model"])])),_:1},8,["title","modelValue"]),s.dataDialogVisible&&s.currentStrategyData&&s.currentStrategyData.id?(b(),S(ee,{key:0,visible:s.dataDialogVisible,"strategy-id":s.currentStrategyData.id,"onUpdate:visible":t[27]||(t[27]=e=>s.dataDialogVisible=e)},null,8,["visible","strategy-id"])):T("",!0)])}],["__scopeId","data-v-3210287a"]]);export{Ne as default};
