import{g as e,a as t,d as a}from"./backtest-197f7971.js";import{a5 as l,V as r,ab as n,ac as i,c as s,o as d,d as o,f as u,w as c,t as m,z as f,e as _,i as g,x as p,A as h}from"./index-996b1aff.js";import{P as w}from"./index-e7ada867.js";import{_ as b}from"./_plugin-vue_export-helper-1b428a4d.js";const y={class:"backtest-records-page"},x={class:"header-bar"},R={class:"table-actions"},D={class:"left-actions"},k={class:"right-actions"},V={key:0,class:"text-center py-4"},v={key:1},C={class:"text-danger"},Q={class:"text-danger"};const $=b({name:"BacktestRecords",components:{View:l,Plus:r,DataAnalysis:n,Delete:i,Pagination:w},data:()=>({list:null,total:0,listLoading:!0,listQuery:{page:1,size:20,name:void 0,strategy_name:void 0,status:void 0,start_date:void 0,end_date:void 0,project_id:void 0},dateRange:null,dialogVisible:!1,currentRecord:{}}),methods:{async getList(){this.listLoading=!0;try{const{data:t}=await e(this.listQuery);this.list=t.items,this.total=t.total}catch(t){this.$message.error("获取回测记录列表失败")}this.listLoading=!1},handleFilter(){this.listQuery.page=1,this.getList()},handleDateChange(e){e?(this.listQuery.start_date=e[0],this.listQuery.end_date=e[1]):(this.listQuery.start_date=void 0,this.listQuery.end_date=void 0)},async handleViewDetail(e){try{const{data:a}=await t(e.id);this.currentRecord=a,this.dialogVisible=!0}catch(a){this.$message.error("获取回测详情失败")}},handleViewBacktest(e){this.$router.push(`/strategy/backtest/${e.id}`)},handleCreateBacktest(){this.$router.push("/strategy/backtest/create")},async handleDelete(e){try{await this.$confirm("确定要删除这个回测记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await a(e.id),this.$message.success("删除成功"),this.getList()}catch(t){"cancel"!==t&&this.$message.error("删除回测记录失败")}},formatDate(e){if(!e)return"";const t=new Date(e),a=e=>e.toString().padStart(2,"0");return`${t.getFullYear()}-${a(t.getMonth()+1)}-${a(t.getDate())}`},formatDateTime(e){if(!e)return"";const t=new Date(e),a=e=>e.toString().padStart(2,"0");return`${t.getFullYear()}-${a(t.getMonth()+1)}-${a(t.getDate())} ${a(t.getHours())}:${a(t.getMinutes())}`},formatNumber:(e,t=2)=>null==e?"-":Number(e).toFixed(t).replace(/\.?0+$/,""),formatPercent:e=>null==e?"-":(100*Number(e)).toFixed(2)+"%",getStatusType:e=>({running:"warning",completed:"success",failed:"danger",cancelled:"info"}[e]||"info"),getStatusText:e=>({running:"运行中",completed:"已完成",failed:"失败",cancelled:"已取消"}[e]||e)},created(){this.getList()}},[["render",function(e,t,a,l,r,n){const i=s("el-input"),w=s("el-option"),b=s("el-select"),$=s("el-date-picker"),P=s("el-button"),T=s("Plus"),N=s("el-icon"),S=s("el-skeleton"),Y=s("el-table-column"),L=s("el-link"),z=s("el-tag"),B=s("View"),M=s("el-tooltip"),U=s("DataAnalysis"),F=s("Delete"),j=s("el-table"),A=s("el-card"),I=s("pagination"),H=s("el-descriptions-item"),q=s("el-descriptions"),E=s("el-dialog");return d(),o("div",y,[u(A,{shadow:"hover"},{header:c((()=>[_("div",x,[_("div",R,[_("div",D,[u(i,{modelValue:r.listQuery.name,"onUpdate:modelValue":t[0]||(t[0]=e=>r.listQuery.name=e),placeholder:"回测名称",style:{width:"180px"},class:"filter-item"},null,8,["modelValue"]),u(i,{modelValue:r.listQuery.strategy_name,"onUpdate:modelValue":t[1]||(t[1]=e=>r.listQuery.strategy_name=e),placeholder:"策略名称",style:{width:"150px"},class:"filter-item"},null,8,["modelValue"]),u(b,{modelValue:r.listQuery.status,"onUpdate:modelValue":t[2]||(t[2]=e=>r.listQuery.status=e),placeholder:"回测状态",clearable:"",style:{width:"120px"},class:"filter-item"},{default:c((()=>[u(w,{label:"运行中",value:"running"}),u(w,{label:"已完成",value:"completed"}),u(w,{label:"失败",value:"failed"}),u(w,{label:"已取消",value:"cancelled"})])),_:1},8,["modelValue"]),u($,{modelValue:r.dateRange,"onUpdate:modelValue":t[3]||(t[3]=e=>r.dateRange=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"240px"},class:"filter-item",onChange:n.handleDateChange},null,8,["modelValue","onChange"]),u(P,{type:"primary",onClick:n.handleFilter,class:"filter-item"},{default:c((()=>t[7]||(t[7]=[g("查询")]))),_:1},8,["onClick"])]),_("div",k,[u(P,{type:"primary",onClick:n.handleCreateBacktest},{default:c((()=>[u(N,null,{default:c((()=>[u(T)])),_:1}),t[8]||(t[8]=g(" 新建回测 "))])),_:1},8,["onClick"])])])])])),default:c((()=>[r.listLoading?(d(),o("div",V,[u(S,{rows:4,animated:""})])):(d(),o("div",v,[u(j,{data:r.list||[],style:{width:"100%"},size:"small",align:"left",border:"",fit:"","highlight-current-row":""},{default:c((()=>[u(Y,{align:"center",label:"ID",width:"80"},{default:c((e=>[g(p(e.row.id),1)])),_:1}),u(Y,{label:"回测名称","min-width":"150"},{default:c((e=>[u(L,{type:"primary",onClick:t=>n.handleViewDetail(e.row)},{default:c((()=>[g(p(e.row.name),1)])),_:2},1032,["onClick"])])),_:1}),u(Y,{label:"策略名称","min-width":"120"},{default:c((e=>[g(p(e.row.strategy_name),1)])),_:1}),u(Y,{label:"回测状态",align:"center",width:"100"},{default:c((e=>[u(z,{type:n.getStatusType(e.row.status)},{default:c((()=>[g(p(n.getStatusText(e.row.status)),1)])),_:2},1032,["type"])])),_:1}),u(Y,{label:"回测周期",align:"center",width:"180"},{default:c((e=>[g(p(n.formatDate(e.row.start_time))+" ~ "+p(n.formatDate(e.row.end_time)),1)])),_:1}),u(Y,{label:"总收益率",align:"right",width:"120"},{default:c((e=>[_("span",{class:h(e.row.total_return>=0?"text-success":"text-danger")},p(e.row.total_return>=0?"+":"")+p(n.formatPercent(e.row.total_return)),3)])),_:1}),u(Y,{label:"年化收益率",align:"right",width:"120"},{default:c((e=>[_("span",{class:h(e.row.annual_return>=0?"text-success":"text-danger")},p(e.row.annual_return>=0?"+":"")+p(n.formatPercent(e.row.annual_return)),3)])),_:1}),u(Y,{label:"最大回撤",align:"right",width:"100"},{default:c((e=>[_("span",C,p(n.formatPercent(e.row.max_drawdown)),1)])),_:1}),u(Y,{label:"夏普比率",align:"right",width:"100"},{default:c((e=>[g(p(n.formatNumber(e.row.sharpe_ratio,2)),1)])),_:1}),u(Y,{label:"总交易次数",align:"center",width:"100"},{default:c((e=>[g(p(e.row.total_trades),1)])),_:1}),u(Y,{label:"胜率",align:"right",width:"80"},{default:c((e=>[g(p(n.formatPercent(e.row.win_rate)),1)])),_:1}),u(Y,{label:"创建时间",align:"center",width:"160"},{default:c((e=>[g(p(n.formatDateTime(e.row.created_at)),1)])),_:1}),u(Y,{label:"操作",align:"center",width:"200"},{default:c((e=>[u(M,{content:"查看详情",placement:"top"},{default:c((()=>[u(P,{size:"small",onClick:t=>n.handleViewDetail(e.row),circle:""},{default:c((()=>[u(N,null,{default:c((()=>[u(B)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024),u(M,{content:"查看回测",placement:"top"},{default:c((()=>[u(P,{size:"small",type:"primary",onClick:t=>n.handleViewBacktest(e.row),circle:""},{default:c((()=>[u(N,null,{default:c((()=>[u(U)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024),u(M,{content:"删除",placement:"top"},{default:c((()=>[u(P,{size:"small",type:"danger",onClick:t=>n.handleDelete(e.row),circle:""},{default:c((()=>[u(N,null,{default:c((()=>[u(F)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:1})])),_:1},8,["data"])]))])),_:1}),m(u(I,{total:r.total,page:r.listQuery.page,"onUpdate:page":t[4]||(t[4]=e=>r.listQuery.page=e),limit:r.listQuery.size,"onUpdate:limit":t[5]||(t[5]=e=>r.listQuery.size=e),onPagination:n.getList},null,8,["total","page","limit","onPagination"]),[[f,r.total>0]]),u(E,{modelValue:r.dialogVisible,"onUpdate:modelValue":t[6]||(t[6]=e=>r.dialogVisible=e),title:"回测详情",width:"800px"},{default:c((()=>[u(q,{column:2,border:""},{default:c((()=>[u(H,{label:"回测ID"},{default:c((()=>[g(p(r.currentRecord.id),1)])),_:1}),u(H,{label:"回测名称"},{default:c((()=>[g(p(r.currentRecord.name),1)])),_:1}),u(H,{label:"策略名称"},{default:c((()=>[g(p(r.currentRecord.strategy_name),1)])),_:1}),u(H,{label:"回测状态"},{default:c((()=>[u(z,{type:n.getStatusType(r.currentRecord.status)},{default:c((()=>[g(p(n.getStatusText(r.currentRecord.status)),1)])),_:1},8,["type"])])),_:1}),u(H,{label:"开始时间"},{default:c((()=>[g(p(n.formatDateTime(r.currentRecord.start_time)),1)])),_:1}),u(H,{label:"结束时间"},{default:c((()=>[g(p(n.formatDateTime(r.currentRecord.end_time)),1)])),_:1}),u(H,{label:"初始资金"},{default:c((()=>[g(p(n.formatNumber(r.currentRecord.initial_capital,2)),1)])),_:1}),u(H,{label:"最终资金"},{default:c((()=>[g(p(n.formatNumber(r.currentRecord.final_capital,2)),1)])),_:1}),u(H,{label:"总收益率"},{default:c((()=>[_("span",{class:h(r.currentRecord.total_return>=0?"text-success":"text-danger")},p(r.currentRecord.total_return>=0?"+":"")+p(n.formatPercent(r.currentRecord.total_return)),3)])),_:1}),u(H,{label:"年化收益率"},{default:c((()=>[_("span",{class:h(r.currentRecord.annual_return>=0?"text-success":"text-danger")},p(r.currentRecord.annual_return>=0?"+":"")+p(n.formatPercent(r.currentRecord.annual_return)),3)])),_:1}),u(H,{label:"最大回撤"},{default:c((()=>[_("span",Q,p(n.formatPercent(r.currentRecord.max_drawdown)),1)])),_:1}),u(H,{label:"夏普比率"},{default:c((()=>[g(p(n.formatNumber(r.currentRecord.sharpe_ratio,2)),1)])),_:1}),u(H,{label:"总交易次数"},{default:c((()=>[g(p(r.currentRecord.total_trades),1)])),_:1}),u(H,{label:"胜率"},{default:c((()=>[g(p(n.formatPercent(r.currentRecord.win_rate)),1)])),_:1}),u(H,{label:"平均持仓时间"},{default:c((()=>[g(p(r.currentRecord.avg_hold_time),1)])),_:1}),u(H,{label:"最大单笔盈利"},{default:c((()=>[g(p(n.formatNumber(r.currentRecord.max_profit,2)),1)])),_:1}),u(H,{label:"最大单笔亏损"},{default:c((()=>[g(p(n.formatNumber(r.currentRecord.max_loss,2)),1)])),_:1}),u(H,{label:"盈亏比"},{default:c((()=>[g(p(n.formatNumber(r.currentRecord.profit_loss_ratio,2)),1)])),_:1}),u(H,{label:"创建时间"},{default:c((()=>[g(p(n.formatDateTime(r.currentRecord.created_at)),1)])),_:1}),u(H,{label:"完成时间"},{default:c((()=>[g(p(n.formatDateTime(r.currentRecord.completed_at)),1)])),_:1}),u(H,{label:"备注",span:2},{default:c((()=>[g(p(r.currentRecord.remark||"-"),1)])),_:1})])),_:1})])),_:1},8,["modelValue"])])}],["__scopeId","data-v-2c4e0ea6"]]);export{$ as default};
