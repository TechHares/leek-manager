import{r as e,M as a,m as l,c as t,o,d as n,f as r,w as u,E as s,i as c,F as d,O as i,h as m,e as f,P as _,q as v,x as g,p,a4 as y}from"./index-996b1aff.js";import{a as h,b,c as w,r as V,d as x,e as k}from"./config-a0f2273b.js";import{D as O}from"./DynamicForm-adccf113.js";import{_ as j}from"./_plugin-vue_export-helper-1b428a4d.js";const I={class:"setting-page"},N={class:"mb-2"},U={class:"card-content-left"},B=j({__name:"Setting",setup(j){const B=e({log_level:"INFO",log_format:"json",log_alarm:!1,alert_methods:[],alert_config:[],mount_dirs:[]}),E=e("{}"),R=e(!1),T=e([]),C=e(!1),F=e(!1),S=e(!1),A=async()=>{if(localStorage.getItem("current_project_id"))try{const e=await h();B.value={...e.data,alert_methods:e.data.alert_config?e.data.alert_config.map((e=>e.class_name)):[],alert_config:e.data.alert_config?Object.fromEntries(e.data.alert_config.map((e=>[e.class_name,e.config||{}]))):{},mount_dirs:e.data.mount_dirs||[]},await J()}catch(e){s.error("加载配置失败")}else s.error("请先选择项目")},D=async()=>{if(localStorage.getItem("current_project_id")){R.value=!0;try{const e=B.value.alert_methods.map((e=>({class_name:e,enabled:!0,config:B.value.alert_config[e]||{}})));await w({...B.value,alert_config:e,mount_dirs:B.value.mount_dirs}),s.success("保存成功"),A()}catch(e){s.error("保存失败")}finally{R.value=!1}}else s.error("请先选择项目")},G=e=>{if(!e||0===e.length)return;const a=e,l=a[a.length-1];a.filter((e=>e===l)).length>1&&(B.value.mount_dirs=a.filter(((e,t)=>e!==l||t===a.lastIndexOf(l))),s.warning("该目录已添加，无需重复！"))},J=async()=>{try{const{data:e}=await b();T.value=e}catch(e){s.error("获取告警模板失败")}},W=e=>T.value.find((a=>a.cls===e)),q=e=>{const a=W(e);return a?a.name:e};a((()=>B.value.alert_methods),((e,a)=>{a.filter((a=>!e.includes(a))).forEach((e=>{delete B.value.alert_config[e]})),e.forEach((e=>{B.value.alert_config[e]||(B.value.alert_config[e]={})}))}),{deep:!0});const M=async()=>{try{await _.confirm("确认重启交易引擎?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),C.value=!0,await V(),s.success("重启指令已发送")}catch(e){"cancel"!==e&&s.error("重启失败")}finally{C.value=!1}},P=async()=>{try{await _.confirm("确认刷新挂载目录?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),F.value=!0,await x(),s.success("挂载目录已刷新")}catch(e){"cancel"!==e&&s.error("刷新挂载目录失败")}finally{F.value=!1}},z=async()=>{try{await _.confirm("确认重置仓位状态? 该操作会清除所有策略的仓位信息，请谨慎操作!","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),S.value=!0,await k(),s.success("重置仓位状态成功")}catch(e){"cancel"!==e&&s.error("重置仓位状态失败")}finally{S.value=!1}};return l((()=>{A()})),a((()=>B.value.alert_config),(e=>{E.value=JSON.stringify(e,null,2)})),(e,a)=>{const l=t("el-alert"),s=t("el-option"),_=t("el-select"),h=t("el-form-item"),b=t("el-radio"),w=t("el-radio-group"),V=t("el-checkbox"),x=t("el-checkbox-group"),k=t("el-icon"),j=t("el-tooltip"),E=t("el-button"),A=t("el-form"),J=t("el-card");return o(),n("div",I,[r(J,null,{default:u((()=>[r(l,{title:"系统设置不会实时生效， 引擎只在启动时应用系统设置",type:"warning","show-icon":"",class:"mb-4"}),r(A,{model:B.value,"label-width":"100px"},{default:u((()=>[r(h,{label:"日志等级"},{default:u((()=>[r(_,{modelValue:B.value.log_level,"onUpdate:modelValue":a[0]||(a[0]=e=>B.value.log_level=e),style:{width:"200px"}},{default:u((()=>[r(s,{label:"DEBUG",value:"DEBUG"}),r(s,{label:"INFO",value:"INFO"}),r(s,{label:"WARNING",value:"WARNING"}),r(s,{label:"ERROR",value:"ERROR"})])),_:1},8,["modelValue"])])),_:1}),r(h,{label:"日志格式"},{default:u((()=>[r(w,{modelValue:B.value.log_format,"onUpdate:modelValue":a[1]||(a[1]=e=>B.value.log_format=e)},{default:u((()=>[r(b,{value:"json"},{default:u((()=>a[5]||(a[5]=[c("JSON")]))),_:1}),r(b,{value:"text"},{default:u((()=>a[6]||(a[6]=[c("Text")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),r(h,{label:"错误日志告警"},{default:u((()=>[r(w,{modelValue:B.value.log_alarm,"onUpdate:modelValue":a[2]||(a[2]=e=>B.value.log_alarm=e)},{default:u((()=>[r(b,{label:!0},{default:u((()=>a[7]||(a[7]=[c("开启")]))),_:1}),r(b,{label:!1},{default:u((()=>a[8]||(a[8]=[c("关闭")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),r(h,{label:"告警方式"},{default:u((()=>[r(x,{modelValue:B.value.alert_methods,"onUpdate:modelValue":a[3]||(a[3]=e=>B.value.alert_methods=e)},{default:u((()=>[(o(!0),n(d,null,i(T.value,(e=>(o(),v(V,{key:e.cls,value:e.cls},{default:u((()=>[c(g(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1}),r(h,{label:"参数"},{default:u((()=>[(o(!0),n(d,null,i(B.value.alert_methods,(e=>(o(),n("div",{key:e,class:"mb-4"},[f("div",N,g(q(e))+"配置：",1),W(e)&&Array.isArray(W(e).parameters)?(o(),v(O,{fields:W(e).parameters,modelValue:B.value.alert_config[e],"onUpdate:modelValue":a=>B.value.alert_config[e]=a,key:e},null,8,["fields","modelValue","onUpdate:modelValue"])):p("",!0)])))),128))])),_:1}),r(h,{label:"挂载代码目录"},{label:u((()=>[a[9]||(a[9]=c(" 挂载代码目录 ")),r(j,{content:"自定义的策略、数据源、交易器等组件在这里挂载到系统中",placement:"top"},{default:u((()=>[r(k,{class:"ml-1 cursor-help"},{default:u((()=>[r(m(y))])),_:1})])),_:1})])),default:u((()=>[r(_,{modelValue:B.value.mount_dirs,"onUpdate:modelValue":a[4]||(a[4]=e=>B.value.mount_dirs=e),multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"请输入目录，回车添加",style:{width:"100%"},onChange:G},{default:u((()=>[(o(!0),n(d,null,i(B.value.mount_dirs,(e=>(o(),v(s,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),r(h,null,{default:u((()=>[r(E,{type:"primary",onClick:D,loading:R.value},{default:u((()=>a[10]||(a[10]=[c("保存")]))),_:1},8,["loading"])])),_:1})])),_:1},8,["model"])])),_:1}),r(J,{class:"mt-4",header:""},{default:u((()=>[f("div",U,[r(E,{type:"success",onClick:P,loading:F.value},{default:u((()=>a[11]||(a[11]=[c("刷新挂载目录")]))),_:1},8,["loading"]),r(E,{type:"danger",onClick:M,loading:C.value},{default:u((()=>a[12]||(a[12]=[c("重启引擎")]))),_:1},8,["loading"]),r(E,{type:"warning",onClick:z,loading:S.value},{default:u((()=>a[13]||(a[13]=[c("重置仓位状态")]))),_:1},8,["loading"])])])),_:1})])}}},[["__scopeId","data-v-d3f2a11a"]]);export{B as default};
